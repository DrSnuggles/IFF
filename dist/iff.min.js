function log(e){window.iffdebug&&console.log("IFF:",e);const t=document.getElementById("info");t&&(t.innerHTML+=e+"<br/>")}function getString(e,t){let n=(new TextDecoder).decode(e.dv.buffer.slice(e.idx,e.idx+t));return n=n.replace(/\u0000/g,""),e.idx+=t,n}function getUint8(e){const t=e.dv.getUint8(e.idx);return e.idx++,t}function getUint16(e){const t=e.dv.getUint16(e.idx,!1);return e.idx+=2,t}function getUint24(e){return(getUint8(e)<<24)+(getUint8(e)<<16)+(getUint8(e)<<8)}function getUint32(e){const t=e.dv.getUint32(e.idx,!1);return e.idx+=4,t}function getInt16(e){const t=e.dv.getInt16(e.idx,!1);return e.idx+=2,t}function getInt24(e){return getUint24(e)|0}function getInt32(e){const t=e.dv.getInt32(e.idx,!1);return e.idx+=4,t}function readChunk(e){return{name:getString(e,4),size:getInt32(e)}}function processCommonChunks(e,t){switch(t.name){case"(c) ":e.copyright=getString(e,t.size),log("Copyright: "+e.copyright);break;case"ANNO":e.annotation=getString(e,t.size),log("Annotation: "+e.annotation);break;case"AUTH":e.author=getString(e,t.size),log("Author: "+e.author);break;case"CHRS":e.characterString=getString(e,t.size),log("CharString: "+e.characterString);break;case"CSET":e.characterSet=getString(e,t.size),log("CharSet: "+e.characterSet);break;case"FTXT":e.formattedText=getString(e,t.size),log("FTXT: "+e.formattedText);break;case"FVER":e.amigaOS=getString(e,t.size),log("AmigaOS: "+e.amigaOS);break;case"HLID":e.hotLink=getString(e,t.size),log("HotlinkID: "+e.hotLink);break;case"NAME":e.name=getString(e,t.size),log("Name: "+e.name);break;case"OCMP":e.computer=getString(e,t.size),log("Computer: "+e.computer);break;case"OCPU":e.cpu=getString(e,t.size),log("CPU: "+e.cpu);break;case"OPGM":e.pgm=getString(e,t.size),log("Program: "+e.pgm);break;case"OSN ":e.sn=getString(e,t.size),log("Serial#: "+e.sn);break;case"PTXT":e.privText=getString(e,t.size),log("PrivateText: "+e.privText);break;case"TEXT":e.text=getString(e,t.size),log("Text: "+e.text);break;case"UNAM":e.userName=getString(e,t.size),log("Username: "+e.userName);break;case"VERS":e.version=getString(e,t.size),log("Version: "+e.version);break;default:log("Skipping chunk: "+t.name),e.idx+=t.size>0?t.size:-7}}function unpack_ByteRun1(e){const t=new Int8Array(e),n=[];let r=0;for(;r<t.length;){var i=t[r++];if(i>=0&&i<=127)for(let e=0;e<i+1;e++)n.push(t[r++]);else if(i>=-127&&i<=-1){var o=e[r++];for(let e=0;e<1-i;e++)n.push(o)}}return n}async function parse(e){for(e.ctbl=!1,e.sham=!1,e.color_animations=[],e.colorCycling=!1,e.colorCyclingPaused=!1,e.transparency=!1;e.idx<e.dv.byteLength-8;){const i=readChunk(e);switch(i.name){case"BODY":log("BODY chunk size: "+i.size),e.data=new Uint8Array(i.size),e.data.set(new Uint8Array(e.dv.buffer).slice(e.idx,e.idx+i.size)),e.idx+=i.size,e.bmhd.compression&&(e.data=unpack_ByteRun1(e.data));break;case"BMHD":log("BMHD chunk size: "+i.size),e.bmhd={w:getUint16(e),h:getUint16(e),x:getInt16(e),y:getInt16(e),nPlanes:getUint8(e),masking:getUint8(e),compression:getUint8(e),pad1:getUint8(e),transparentColor:getUint16(e),xAspect:getUint8(e),yAspect:getUint8(e),pageWidth:getInt16(e),pageHeight:getInt16(e)},log("w: "+e.bmhd.w),log("h: "+e.bmhd.h),log("x: "+e.bmhd.x),log("y: "+e.bmhd.y),log("nPlanes: "+e.bmhd.nPlanes),log("masking: "+e.bmhd.masking),log("compression: "+e.bmhd.compression),log("transparentColor: "+e.bmhd.transparentColor),log("xAspect: "+e.bmhd.xAspect),log("yAspect: "+e.bmhd.yAspect),log("pageWidth: "+e.bmhd.pageWidth),log("pageHeight: "+e.bmhd.pageHeight);break;case"CMAP":log("CMAP chunk size: "+i.size),e.cmap=[],e.pal=[];for(let t=0;t<i.size;t+=3){const t=getUint8(e),n=getUint8(e),r=getUint8(e);e.cmap.push([t,n,r,255]),e.pal.push(t,n,r)}for(e.cmap_bits=0;e.cmap.length>1<<e.cmap_bits;)e.cmap_bits++;isCMAPScaled(e)||scaleCMAP(e),e.cmap_overlay=new Array(e.cmap.length),log("2^"+e.bmhd.nPlanes+"="+Math.pow(2,e.bmhd.nPlanes)+" ?= "+e.cmap.length),Math.pow(2,e.bmhd.nPlanes)!==e.cmap.length&&log("num colors in cmap do not match bitplanes");break;case"CAMG":if(log("CAMG chunk size: "+i.size),e.mode={BPLCON1:getUint16(e),BPLCON0:getUint16(e)},e.mode={...e.mode,HIRES:32768&e.mode.BPLCON0,BPU:(28672&e.mode.BPLCON0)>>12,HAM:2048&e.mode.BPLCON0,DPF:1024&e.mode.BPLCON0,COLOR:512&e.mode.BPLCON0,GAUD:256&e.mode.BPLCON0,UHRES:128&e.mode.BPLCON0,SHRES:64&e.mode.BPLCON0,BYPASS:32&e.mode.BPLCON0,BPU3:16&e.mode.BPLCON0,LPEN:8&e.mode.BPLCON0,LACE:4&e.mode.BPLCON0,ERSY:2&e.mode.BPLCON0,ECSENA:1&e.mode.BPLCON0,EHB:128&e.mode.BPLCON0},e.mode.ehb&&e.cmap_bits==e.bmhd.nPlanes&&(log("EHB detected"),f.cmap_bits--,f.cmap.length=f.cmap.length>>1,f.cmap_overlay.length=f.cmap.length),e.mode.HAM&&e.cmap_bits>e.bmhd.nPlanes-2){const t=e.cmap_bits-e.bmhd.nPlanes+2;log("HAM delta: "+t),e.cmap_bits-=t,e.cmap.length=e.cmap.length>>t,e.cmap_overlay.length=e.cmap.length}break;case"CRNG":log("CRNG chunk size: "+i.size),e.crng||(e.crng=[]);let o=[];for(let t=0;t<i.size;t++)o.push(getUint8(e));e.crng.push(o),e.idx-=i.size-2;var t={rate:getUint16(e)},n=getUint16(e);if(t.active=!!t.rate&&1&n,t.reverse=2&n,t.timestamp=0,t.delay_sec=t.rate?16384/(50*t.rate):0,t.lower=getUint8(e),t.upper=getUint8(e),log("Animation active: "+t.active),t.active){log("Animation n°"+e.color_animations.length),log("Rate: "+t.rate+" ("+t.delay_sec.toFixed(2)+")"),log("Range: x"+t.lower.toString(16)+" -> x"+t.upper.toString(16)),log("Reverse: "+Boolean(t.reverse)),e.color_animations.push(t);for(var r=t.lower;r<=t.upper;r++)e.cmap_overlay[r]=r}break;case"CTBL":log("CTBL chunk size: "+i.size);const s=Math.pow(2,e.bmhd.nPlanes);e.ctbl=[],log("CTBL palettes: "+i.size/2/s),e.bmhd.h!=i.size/2/s&&log("CTBL palettes do not match height");for(let t=0;t<i.size/2;t++){const n=getUint16(e),r=Math.floor(t/s),i=t%s;0==i&&e.ctbl.push([]),e.ctbl[r].push([]),e.ctbl[r][i].push(padTo8bits(n>>8&15,4)),e.ctbl[r][i].push(padTo8bits(n>>4&15,4)),e.ctbl[r][i].push(padTo8bits(15&n,4)),e.ctbl[r][i].push(255)}break;case"SHAM":e.sham=[];const a=16,l=getUint16(e);log("SHAM chunk size: "+i.size+" version: "+l),log("SHAM palettes: "+(i.size-2)/2/a),e.bmhd.h!=(i.size-2)/2/a&&log("SHAM palettes do not match height");for(let t=0;t<(i.size-2)/2;t++){const n=getUint16(e),r=Math.floor(t/a),i=t%a;0==i&&e.sham.push([]),e.sham[r].push([]),e.sham[r][i].push(padTo8bits(n>>8&15,4)),e.sham[r][i].push(padTo8bits(n>>4&15,4)),e.sham[r][i].push(padTo8bits(15&n,4)),e.sham[r][i].push(255)}break;case"DPI ":e.dpi={x:getUint16(e),y:getUint16(e)};break;case"PCHG":case"PDDP":e.idx+=i.size;break;default:processCommonChunks(e,i)}}"PBM "===e.subType?e.bmhd.pixBuf=e.data:e.bmhd.pixBuf=bitPlaneToPixBuffer(e),e.show=(t,n)=>{showILBM(e,t,n)},e.play=()=>{startColorCycling(e)},e.stop=()=>{stopColorCycling(e)},e.pause=()=>{pauseColorCycling(e)},e.resume=()=>{resumeColorCycling(e)}}function padTo8bits(e,t){for(var n=0,r=8-t;r>=0;r-=t)n|=e<<r;return n}function isCMAPScaled(e){var t=(1<<e.cmap_bits)-1;for(let n=0;n<e.cmap.length;n++)for(let r=0;r<3;r++){if(e.cmap[n][r]&t)return!0}return!1}function scaleCMAP(e){for(let n=0;n<e.cmap.length;n++)for(let r=0;r<3;r++){var t=e.cmap[n][r]>>8-e.cmap_bits;e.cmap[n][r]=padTo8bits(t,e.cmap_bits)}log("CMAP scaled")}function showILBM(e,t,n){e.transparency=!!n,0!=e.bmhd.yAspect?e.bmhd.ratio=e.bmhd.xAspect/e.bmhd.yAspect:e.bmhd.ratio=1;var r=Math.ceil(e.bmhd.ratio),i=e.bmhd.xAspect/(r*e.bmhd.yAspect);e.bmhd.eff_w=e.bmhd.w*r,e.bmhd.eff_h=e.bmhd.h/i,t.width=e.bmhd.eff_w,t.height=e.bmhd.eff_h,e.render_canvas=document.createElement("canvas"),e.render_canvas.width=e.bmhd.w,e.render_canvas.height=e.bmhd.h;for(var o=e.render_canvas.getContext("2d"),s=o.createImageData(e.bmhd.w,e.bmhd.h),a=0,l=[0,0,0,255];a<e.bmhd.pixBuf.length;){var c=e.bmhd.pixBuf[a];c<0&&(c+=256),l=resolvePixels(e,c,l,Math.floor(a/e.bmhd.w),a%e.bmhd.w);for(let e=0;e<4;e++)s.data[4*a+e]=l[e];a++}o.putImageData(s,0,0),e.display_ctx=t.getContext("2d"),e.display_ctx.drawImage(e.render_canvas,0,0,e.bmhd.w,e.bmhd.h,0,0,e.bmhd.eff_w,e.bmhd.eff_h)}function resolveHAMPixel(e,t,n){var r=t>>e.cmap_bits&3,i=padTo8bits(t%e.cmap.length,e.cmap_bits),o=[n[0],n[1],n[2],255];return 1==r?o[2]=i:2==r?o[0]=i:o[1]=i,o}function resolveEHBPixel(e,t){var n=e.cmap[t%e.cmap.length];return[n[0]>>1,n[1]>>1,n[2]>>1,255]}function resolveRGB24Pixel(e){return[255&e,(65280&e)>>8,(16711680&e)>>16,255]}function resolvePixels(e,t,n,r,i){return null==t&&(t=0),!e.transparency||2!=e.bmhd.masking&&3!=e.bmhd.masking||t!=e.bmhd.transparentColor?void 0===e.cmap&&24==e.bmhd.nPlanes?resolveRGB24Pixel(t):t<e.cmap.length?e.sham?e.sham[r][t]:e.ctbl?e.ctbl[r][t]:e.cmap[t]:e.mode.HAM?(0==i&&(n=[0,0,0,255]),resolveHAMPixel(e,t,n)):e.mode.ehb?resolveEHBPixel(e,t):(console.log("oops no color resolve found"),[0,0,0,0]):[0,0,0,255]}function resolveOverlayPixels(e,t){var n;if(t>=e.cmap_overlay_length){if(!e.mode.ehb)return;var r=e.cmap_overlay[t%e.cmap_length];if(null==r)return;n=r+e.cmap_overlay_length}else n=e.cmap_overlay[t];if(null!=n)return resolvePixels(e,n,[0,0,0,255])}function bitPlaneToPixBuffer(e){var t=e.bmhd.w+15>>4<<1,n=new Array(e.bmhd.w*e.bmhd.h).fill(0),r=e.bmhd.nPlanes;1==e.bmhd.masking&&(r+=1);for(let l=0;l<e.bmhd.h;l++)for(let c=0;c<r;c++){var i=1<<c;for(let u=0;u<t;u++){var o=l*r*t+c*t+u,s=e.data[o];for(let t=0;t<8;t++){if(s&1<<7-t){var a=8*u+t;n[l*e.bmhd.w+a]|=i}}}}return n}function startColorCycling(e){if(e.render_canvas)return e.color_animations.length>0&&(e.colorCycling=!0,e.colorCyclingPaused&&(e.colorCyclingPaused=!1,animateIffImage(e,!0)),animateIffImage(e)),e.colorCycling;e.handleError('Canvas not initialized. Call "show(canvas)" first!')}function pauseColorCycling(e){e.color_animations.length>0&&e.render_canvas&&(e.colorCycling?(e.colorCycling=!1,e.colorCyclingPaused=!0):resumeColorCycling(e))}function resumeColorCycling(e){e.color_animations.length>0&&!e.colorCycling&&e.colorCyclingPaused&&(e.colorCyclingPaused=!1,startColorCycling(e))}function stopColorCycling(e){e.color_animations.length>0&&e.render_canvas&&(e.colorCyclingPaused=!1,e.colorCycling=!1,animateIffImage(e,!0))}function animateIffImage(e,t){if(t?resetColorOverLay(e):updateColorOverLay(e)){for(var n=e.render_canvas.getContext("2d"),r=n.getImageData(0,0,e.bmhd.w,e.bmhd.h),i=e.bmhd.w,o=e.bmhd.h,s=0,a=0,l=0;l<e.bmhd.h;l++)for(var c=0;c<e.bmhd.w;c++){var u=l*e.bmhd.w+c,h=l*e.bmhd.w+c,f=e.bmhd.pixBuf[u],m=resolveOverlayPixels(e,f);if(null!=m){for(var g=0;g<3;g++){var d=m[g];r.data[4*h+g]=d}i=Math.min(i,c),o=Math.min(a,l),s=Math.max(s,0),a=Math.max(a,0)}}var p=e.bmhd.w-s,b=e.bmhd.h-a;n.putImageData(r,0,0,i,o,p,b),e.display_ctx.drawImage(e.render_canvas,0,0,e.bmhd.w,e.bmhd.h,0,0,e.bmhd.eff_w,e.bmhd.eff_h)}e.colorCycling&&!t&&window.requestAnimFrame((function(){animateIffImage(e)}))}function updateColorOverLay(e){for(var t=(new Date).getTime(),n=!1,r=0;r<e.color_animations.length;r++){var i=e.color_animations[r],o=1e3*i.delay_sec;if(!(t-i.timestamp<o)){i.timestamp=t,n=!0;var s=-1;2==i.reverse&&(s=1);for(var a=i.upper-i.lower+1,l=i.lower;l<=i.upper;l++){var c=e.cmap_overlay[l]+s;c>=i.upper&&(c-=a),c<i.lower&&(c+=a),e.cmap_overlay[l]=c}}}return n}function resetColorOverLay(e){for(var t=(new Date).getTime(),n=0;n<e.color_animations.length;n++){var r=e.color_animations[n];r.timestamp=t;for(var i=r.lower;i<=r.upper;i++)e.cmap_overlay[i]=i}return!0}function unpack_Delta(e,t){const n="FDC"===t?[-34,-21,-13,-8,-5,-3,-2,-1,0,1,2,3,5,8,13,21]:[-128,-64,-32,-16,-8,-4,-2,-1,0,1,2,4,8,16,32,64],r=[];r.push(e[1]);for(let t=0;t<2*(e.length-2);++t){const i=e[Math.floor(t/2)+2],o=t%2==0?i>>4:15&i;r.push(r[t]+n[o]&255)}return r}function unpack_ADPCM(e,t,n){let r=Math.ceil(e.length/3),i=65535&n,o=(4294901760&n)>>16,s=0;o||(o=5);let a=0;const l=[],c=[[14336,22016,0,0,0,0,0,0],[14746,15007,19732,26119,0,0,0,0],[13654,13654,14746,15007,16896,19732,26119,26119]],u=[0,1,3,7,15,31,63,127,255];for(;r--;){let n=24/t,r=e[a++]<<16|e[a++]<<8|e[a++];for(;n--;){let e=o>>1,a=r>>n*t,h=a&u[t-1];for(4!=t||15&a||(o=4);h--;)e+=o;s=o*c[t-2][a&u[t-1]],a&1<<t-1&&(e=-e),i=i+e&65535,o=s+8192>>14,o<5&&(o=5),e=i>>6,127<e?l.push(127):-128>e?l.push(-128):l.push(e)}}return l}function resample(e,t,n){const r=[],i=n/t,o=Math.floor(n/t),s=i-o;for(let t=0,n=0;t<e.length;t++){for(let n=0;n<o;n++)r.push(e[t]);n+=s,n>=1&&(r.push(e[t]),n-=1)}return r}async function initContext(e){stop(e);try{e.ctx=new AudioContext({sampleRate:e.sampleRate})}catch(t){log("Error on init new AudioContext() with samplerate "+e.sampleRate+": "+t),log("Retrying without specifying samplerate and using resample() instead."),e.ctx=new AudioContext}if(log("srcRate: "+e.sampleRate),log("destRate: "+e.ctx.sampleRate),e.sampleRate!==e.ctx.sampleRate)for(let t=0;t<e.channels;t++)e.ch[t]=resample(e.ch[t],e.sampleRate,e.ctx.sampleRate);e.duration=e.ch.length>0?e.ch[0].length/e.sampleRate:0,log("duration in seconds: "+e.duration),await e.ctx.audioWorklet.addModule(URL.createObjectURL(new Blob(['class BufferPlayer extends AudioWorkletProcessor{constructor(){super(),this.port.onmessage=this.handleMessage_.bind(this),this.ch=[],this.frame=0}process(e,r,s){if(0==this.ch.length)return!0;if(-1==this.frame)return!0;for(let e=0;e<r[0][0].length;e++){for(let s=0;s<r[0].length;s++)r[0][s][e]=this.ch[s][this.frame];this.frame++,this.frame>=this.ch[0].length&&(this.frame=-1),this.port.postMessage({frame:this.frame})}return!0}handleMessage_(e){e.data.ch&&(this.ch=e.data.ch),e.data.frame>=0&&(this.frame=e.data.frame)}}registerProcessor("bufferplayer-processor",BufferPlayer)'],{type:"application/javascript"}))),e.aw=new AudioWorkletNode(e.ctx,"bufferplayer-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[e.channels]}),e.aw.connect(e.ctx.destination),e.aw.port.onmessage=t=>{t.data.frame>=0?e.currentTime=t.data.frame/e.sampleRate:-1==t.data.frame&&(e.loops?(e.looped++,log("looped: "+e.looped+" of "+(e.loops<0?"infinite (until stop() is called)":e.loops)),e.loops>=0&&e.looped>=e.loops&&(stop(e),e.cbOnEnd&&e.cbOnEnd())):(stop(e),e.cbOnEnd&&e.cbOnEnd()))}}async function play(e,t){e.loops=t,e.looped=0,e.paused=!1,e.currentTime=0,e.aw.port.postMessage({ch:e.ch})}function stop(e){e.paused=!1,e.ctx&&"closed"!==e.ctx.state&&e.ctx.close()}function pause(e){e.paused?resume(e):e.ctx&&"running"===e.ctx.state&&(e.paused=!0,e.ctx.suspend())}function resume(e){e.paused=!1,e.ctx&&"suspended"===e.ctx.state&&e.ctx.resume()}function getPosition(e){return e.currentTime}function setPosition(e,t){e.aw&&e.aw.port.postMessage({frame:Math.round(t*e.sampleRate)})}async function parse$1(e){let t=readChunk(e);if("VHDR"===t.name){for(log("VHDR chunk size: "+t.size),e.vhdr={oneShotHiSamples:getUint32(e),repeatHiSamples:getUint32(e),samplesPerHiCycle:getUint32(e),samplesPerSec:getUint16(e),ctOctave:getUint8(e),sCompression:getUint8(e),volume:getUint32(e)},log("oneShotHiSamples: "+e.vhdr.oneShotHiSamples),log("repeatHiSamples: "+e.vhdr.repeatHiSamples),log("samplesPerHiCycle: "+e.vhdr.samplesPerHiCycle),log("samplesPerSec: "+e.vhdr.samplesPerSec),log("ctOctave: "+e.vhdr.ctOctave),log("sCompression: "+e.vhdr.sCompression),log("volume: "+e.vhdr.volume),e.channels=1,e.sampleRate=e.vhdr.samplesPerSec,log("Bits: "+e.bits);e.idx<e.dv.byteLength-8;)switch(t=readChunk(e),t.name){case"BODY":if(log("BODY chunk size: "+t.size),0===e.vhdr.sCompression)if(8===e.bits)e.data=new Int8Array(t.size),e.data.set(new Int8Array(e.dv.buffer).slice(e.idx,e.idx+t.size));else{e.data=[];for(let n=0;n<t.size/2;n++)e.data.push(e.dv.getInt16(e.idx+2*n,!1));e.data=new Int16Array(e.data)}else{e.data=[];for(let n=0;n<e.channels;n++){const r=t.size/e.channels,i=new Uint8Array(r);i.set(new Uint8Array(e.dv.buffer).slice(e.idx+n*r,e.idx+(n+1)*r)),1==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_Delta(i,"FDC")]),2==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_Delta(i,"EDC")]),3==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_ADPCM(i,2,0)]),4==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_ADPCM(i,3,0)])}e.data=new Int8Array(e.data)}e.idx+=t.size;break;case"CHAN":switch(log("CHAN chunk size: "+t.size),e.chan=getUint32(e),log("CHAN: "+e.chan),e.chan){case 6:e.channels=2;break;case 30:e.channels=4}log("channels: "+e.channels);break;case"PAN ":log("PAN chunk size: "+t.size),e.pan=getUint32(e);break;case"SEQN":log("SEQN chunk size: "+t.size),e.seqn=[];for(let n=0;n<t.size/8;n++)e.seqn.push({start:getUint32(e),end:getUint32(e)});break;case"FADE":log("FADE chunk size: "+t.size),f.fade=getUint32(e);break;case"ATAK":log("ATAK chunk size: "+t.size),e.atak=[];for(let n=0;n<t.size/6;n++)e.atak.push({duration:getUint32(e),dest:getUint32(e)});break;case"RLSE":log("RLSE chunk size: "+t.size),e.rlse=[];for(let n=0;n<t.size/6;n++)e.rlse.push({duration:getUint32(e),dest:getUint32(e)});break;default:processCommonChunks(e,t)}prepareChannels(e),await initContext(e),e.play=t=>{play(e,t)},e.stop=()=>{stop(e)},e.pause=()=>{pause(e)},e.resume=()=>{resume(e)},e.getPosition=()=>getPosition(e),e.setPosition=t=>{setPosition(e,t)}}else e.handleError("Missing VHDR chunk. This is not a valid SVX file.")}function prepareChannels(e){e.ch=[];for(let t=0,n=0;t<e.channels;t++){const t=[];if(8==e.bits)for(let r=0;r<e.data.length/e.channels;r++)t.push(e.data[n++]/128);else for(let r=0;r<e.data.length/e.channels;r++)t.push(e.data[n++]/32768);e.ch.push(new Float32Array(t))}}window.iffdebug=!1;var isNumeric=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,mathceil=Math.ceil,mathfloor=Math.floor,bignumberError="[BigNumber Error] ",tooManyDigits=bignumberError+"Number primitive has more than 15 significant digits: ",BASE=1e14,LOG_BASE=14,MAX_SAFE_INTEGER=9007199254740991,POWS_TEN=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],SQRT_BASE=1e7,MAX=1e9;function clone(e){var t,n,r,i,o,s,a,l,c,u,h=O.prototype={constructor:O,toString:null,valueOf:null},f=new O(1),m=20,g=4,d=-7,p=21,b=-1e7,A=1e7,S=!1,w=1,E=0,v={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},y="0123456789abcdefghijklmnopqrstuvwxyz",C=!0;function O(e,t){var i,o,s,a,l,c,u,h,f=this;if(!(f instanceof O))return new O(e,t);if(null==t){if(e&&!0===e._isBigNumber)return f.s=e.s,void(!e.c||e.e>A?f.c=f.e=null:e.e<b?f.c=[f.e=0]:(f.e=e.e,f.c=e.c.slice()));if((c="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(a=0,l=e;l>=10;l/=10,a++);return void(a>A?f.c=f.e=null:(f.e=a,f.c=[e]))}h=String(e)}else{if(!isNumeric.test(h=String(e)))return r(f,h,c);f.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(a=h.indexOf("."))>-1&&(h=h.replace(".","")),(l=h.search(/e/i))>0?(a<0&&(a=l),a+=+h.slice(l+1),h=h.substring(0,l)):a<0&&(a=h.length)}else{if(intCheck(t,2,y.length,"Base"),10==t&&C)return B(f=new O(e),m+f.e+1,g);if(h=String(e),c="number"==typeof e){if(0*e!=0)return r(f,h,c,t);if(f.s=1/e<0?(h=h.slice(1),-1):1,O.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(tooManyDigits+e)}else f.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(i=y.slice(0,t),a=l=0,u=h.length;l<u;l++)if(i.indexOf(o=h.charAt(l))<0){if("."==o){if(l>a){a=u;continue}}else if(!s&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){s=!0,l=-1,a=0;continue}return r(f,String(e),c,t)}c=!1,(a=(h=n(h,t,10,f.s)).indexOf("."))>-1?h=h.replace(".",""):a=h.length}for(l=0;48===h.charCodeAt(l);l++);for(u=h.length;48===h.charCodeAt(--u););if(h=h.slice(l,++u)){if(u-=l,c&&O.DEBUG&&u>15&&(e>MAX_SAFE_INTEGER||e!==mathfloor(e)))throw Error(tooManyDigits+f.s*e);if((a=a-l-1)>A)f.c=f.e=null;else if(a<b)f.c=[f.e=0];else{if(f.e=a,f.c=[],l=(a+1)%LOG_BASE,a<0&&(l+=LOG_BASE),l<u){for(l&&f.c.push(+h.slice(0,l)),u-=LOG_BASE;l<u;)f.c.push(+h.slice(l,l+=LOG_BASE));l=LOG_BASE-(h=h.slice(l)).length}else l-=u;for(;l--;h+="0");f.c.push(+h)}}else f.c=[f.e=0]}function P(e,t,n,r){var i,o,s,a,l;if(null==n?n=g:intCheck(n,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)l=coeffToString(e.c),l=1==r||2==r&&(s<=d||s>=p)?toExponential(l,s):toFixedPoint(l,s,"0");else if(o=(e=B(new O(e),t,n)).e,a=(l=coeffToString(e.c)).length,1==r||2==r&&(t<=o||o<=d)){for(;a<t;l+="0",a++);l=toExponential(l,o)}else if(t-=s,l=toFixedPoint(l,o,"0"),o+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=o-a)>0)for(o+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function _(e,t){for(var n,r,i=1,o=new O(e[0]);i<e.length;i++)(!(r=new O(e[i])).s||(n=compare(o,r))===t||0===n&&o.s===t)&&(o=r);return o}function x(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+n*LOG_BASE-1)>A?e.c=e.e=null:n<b?e.c=[e.e=0]:(e.e=n,e.c=t),e}function B(e,t,n,r){var i,o,s,a,l,c,u,h=e.c,f=POWS_TEN;if(h){e:{for(i=1,a=h[0];a>=10;a/=10,i++);if((o=t-i)<0)o+=LOG_BASE,s=t,l=h[c=0],u=mathfloor(l/f[i-s-1]%10);else if((c=mathceil((o+1)/LOG_BASE))>=h.length){if(!r)break e;for(;h.length<=c;h.push(0));l=u=0,i=1,s=(o%=LOG_BASE)-LOG_BASE+1}else{for(l=a=h[c],i=1;a>=10;a/=10,i++);u=(s=(o%=LOG_BASE)-LOG_BASE+i)<0?0:mathfloor(l/f[i-s-1]%10)}if(r=r||t<0||null!=h[c+1]||(s<0?l:l%f[i-s-1]),r=n<4?(u||r)&&(0==n||n==(e.s<0?3:2)):u>5||5==u&&(4==n||r||6==n&&(o>0?s>0?l/f[i-s]:0:h[c-1])%10&1||n==(e.s<0?8:7)),t<1||!h[0])return h.length=0,r?(t-=e.e+1,h[0]=f[(LOG_BASE-t%LOG_BASE)%LOG_BASE],e.e=-t||0):h[0]=e.e=0,e;if(0==o?(h.length=c,a=1,c--):(h.length=c+1,a=f[LOG_BASE-o],h[c]=s>0?mathfloor(l/f[i-s]%f[s])*a:0),r)for(;;){if(0==c){for(o=1,s=h[0];s>=10;s/=10,o++);for(s=h[0]+=a,a=1;s>=10;s/=10,a++);o!=a&&(e.e++,h[0]==BASE&&(h[0]=1));break}if(h[c]+=a,h[c]!=BASE)break;h[c--]=0,a=1}for(o=h.length;0===h[--o];h.pop());}e.e>A?e.c=e.e=null:e.e<b&&(e.c=[e.e=0])}return e}function T(e){var t,n=e.e;return null===n?e.toString():(t=coeffToString(e.c),t=n<=d||n>=p?toExponential(t,n):toFixedPoint(t,n,"0"),e.s<0?"-"+t:t)}return O.clone=clone,O.ROUND_UP=0,O.ROUND_DOWN=1,O.ROUND_CEIL=2,O.ROUND_FLOOR=3,O.ROUND_HALF_UP=4,O.ROUND_HALF_DOWN=5,O.ROUND_HALF_EVEN=6,O.ROUND_HALF_CEIL=7,O.ROUND_HALF_FLOOR=8,O.EUCLID=9,O.config=O.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(bignumberError+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(intCheck(n=e[t],0,MAX,t),m=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(intCheck(n=e[t],0,8,t),g=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(intCheck(n[0],-MAX,0,t),intCheck(n[1],0,MAX,t),d=n[0],p=n[1]):(intCheck(n,-MAX,MAX,t),d=-(p=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)intCheck(n[0],-MAX,-1,t),intCheck(n[1],1,MAX,t),b=n[0],A=n[1];else{if(intCheck(n,-MAX,MAX,t),!n)throw Error(bignumberError+t+" cannot be zero: "+n);b=-(A=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(bignumberError+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw S=!n,Error(bignumberError+"crypto unavailable");S=n}else S=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(intCheck(n=e[t],0,9,t),w=n),e.hasOwnProperty(t="POW_PRECISION")&&(intCheck(n=e[t],0,MAX,t),E=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(bignumberError+t+" not an object: "+n);v=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(bignumberError+t+" invalid: "+n);C="0123456789"==n.slice(0,10),y=n}}return{DECIMAL_PLACES:m,ROUNDING_MODE:g,EXPONENTIAL_AT:[d,p],RANGE:[b,A],CRYPTO:S,MODULO_MODE:w,POW_PRECISION:E,FORMAT:v,ALPHABET:y}},O.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!O.DEBUG)return!0;var t,n,r=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&i>=-MAX&&i<=MAX&&i===mathfloor(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%LOG_BASE)<1&&(t+=LOG_BASE),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=BASE||n!==mathfloor(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(bignumberError+"Invalid BigNumber: "+e)},O.maximum=O.max=function(){return _(arguments,-1)},O.minimum=O.min=function(){return _(arguments,1)},O.random=(i=9007199254740992,o=Math.random()*i&2097151?function(){return mathfloor(Math.random()*i)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,i,s,a=0,l=[],c=new O(f);if(null==e?e=m:intCheck(e,0,MAX),i=mathceil(e/LOG_BASE),S)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(i*=2));a<i;)(s=131072*t[a]+(t[a+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[a]=n[0],t[a+1]=n[1]):(l.push(s%1e14),a+=2);a=i/2}else{if(!crypto.randomBytes)throw S=!1,Error(bignumberError+"crypto unavailable");for(t=crypto.randomBytes(i*=7);a<i;)(s=281474976710656*(31&t[a])+1099511627776*t[a+1]+4294967296*t[a+2]+16777216*t[a+3]+(t[a+4]<<16)+(t[a+5]<<8)+t[a+6])>=9e15?crypto.randomBytes(7).copy(t,a):(l.push(s%1e14),a+=7);a=i/7}if(!S)for(;a<i;)(s=o())<9e15&&(l[a++]=s%1e14);for(i=l[--a],e%=LOG_BASE,i&&e&&(s=POWS_TEN[LOG_BASE-e],l[a]=mathfloor(i/s)*s);0===l[a];l.pop(),a--);if(a<0)l=[r=0];else{for(r=-1;0===l[0];l.splice(0,1),r-=LOG_BASE);for(a=1,s=l[0];s>=10;s/=10,a++);a<LOG_BASE&&(r-=LOG_BASE-a)}return c.e=r,c.c=l,c}),O.sum=function(){for(var e=1,t=arguments,n=new O(t[0]);e<t.length;)n=n.plus(t[e++]);return n},n=function(){var e="0123456789";function n(e,t,n,r){for(var i,o,s=[0],a=0,l=e.length;a<l;){for(o=s.length;o--;s[o]*=t);for(s[0]+=r.indexOf(e.charAt(a++)),i=0;i<s.length;i++)s[i]>n-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/n|0,s[i]%=n)}return s.reverse()}return function(r,i,o,s,a){var l,c,u,h,f,d,p,b,A=r.indexOf("."),S=m,w=g;for(A>=0&&(h=E,E=0,r=r.replace(".",""),d=(b=new O(i)).pow(r.length-A),E=h,b.c=n(toFixedPoint(coeffToString(d.c),d.e,"0"),10,o,e),b.e=b.c.length),u=h=(p=n(r,i,o,a?(l=y,e):(l=e,y))).length;0==p[--h];p.pop());if(!p[0])return l.charAt(0);if(A<0?--u:(d.c=p,d.e=u,d.s=s,p=(d=t(d,b,S,w,o)).c,f=d.r,u=d.e),A=p[c=u+S+1],h=o/2,f=f||c<0||null!=p[c+1],f=w<4?(null!=A||f)&&(0==w||w==(d.s<0?3:2)):A>h||A==h&&(4==w||f||6==w&&1&p[c-1]||w==(d.s<0?8:7)),c<1||!p[0])r=f?toFixedPoint(l.charAt(1),-S,l.charAt(0)):l.charAt(0);else{if(p.length=c,f)for(--o;++p[--c]>o;)p[c]=0,c||(++u,p=[1].concat(p));for(h=p.length;!p[--h];);for(A=0,r="";A<=h;r+=l.charAt(p[A++]));r=toFixedPoint(r,u,l.charAt(0))}return r}}(),t=function(){function e(e,t,n){var r,i,o,s,a=0,l=e.length,c=t%SQRT_BASE,u=t/SQRT_BASE|0;for(e=e.slice();l--;)a=((i=c*(o=e[l]%SQRT_BASE)+(r=u*o+(s=e[l]/SQRT_BASE|0)*c)%SQRT_BASE*SQRT_BASE+a)/n|0)+(r/SQRT_BASE|0)+u*s,e[l]=i%n;return a&&(e=[a].concat(e)),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,o,s,a){var l,c,u,h,f,m,g,d,p,b,A,S,w,E,v,y,C,P=r.s==i.s?1:-1,_=r.c,x=i.c;if(!(_&&_[0]&&x&&x[0]))return new O(r.s&&i.s&&(_?!x||_[0]!=x[0]:x)?_&&0==_[0]||!x?0*P:P/0:NaN);for(p=(d=new O(P)).c=[],P=o+(c=r.e-i.e)+1,a||(a=BASE,c=bitFloor(r.e/LOG_BASE)-bitFloor(i.e/LOG_BASE),P=P/LOG_BASE|0),u=0;x[u]==(_[u]||0);u++);if(x[u]>(_[u]||0)&&c--,P<0)p.push(1),h=!0;else{for(E=_.length,y=x.length,u=0,P+=2,(f=mathfloor(a/(x[0]+1)))>1&&(x=e(x,f,a),_=e(_,f,a),y=x.length,E=_.length),w=y,A=(b=_.slice(0,y)).length;A<y;b[A++]=0);C=x.slice(),C=[0].concat(C),v=x[0],x[1]>=a/2&&v++;do{if(f=0,(l=t(x,b,y,A))<0){if(S=b[0],y!=A&&(S=S*a+(b[1]||0)),(f=mathfloor(S/v))>1)for(f>=a&&(f=a-1),g=(m=e(x,f,a)).length,A=b.length;1==t(m,b,g,A);)f--,n(m,y<g?C:x,g,a),g=m.length,l=1;else 0==f&&(l=f=1),g=(m=x.slice()).length;if(g<A&&(m=[0].concat(m)),n(b,m,A,a),A=b.length,-1==l)for(;t(x,b,y,A)<1;)f++,n(b,y<A?C:x,A,a),A=b.length}else 0===l&&(f++,b=[0]);p[u++]=f,b[0]?b[A++]=_[w]||0:(b=[_[w]],A=1)}while((w++<E||null!=b[0])&&P--);h=null!=b[0],p[0]||p.splice(0,1)}if(a==BASE){for(u=1,P=p[0];P>=10;P/=10,u++);B(d,o+(d.e=u+c*LOG_BASE-1)+1,s,h)}else d.e=c,d.r=+h;return d}}(),s=/^(-?)0([xbo])(?=\w[\w.]*$)/i,a=/^([^.]+)\.$/,l=/^\.([^.]+)$/,c=/^-?(Infinity|NaN)$/,u=/^\s*\+(?=[\w.])|^\s+|\s+$/g,r=function(e,t,n,r){var i,o=n?t:t.replace(u,"");if(c.test(o))e.s=isNaN(o)?null:o<0?-1:1;else{if(!n&&(o=o.replace(s,(function(e,t,n){return i="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=i?e:t})),r&&(i=r,o=o.replace(a,"$1").replace(l,"0.$1")),t!=o))return new O(o,i);if(O.DEBUG)throw Error(bignumberError+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},h.absoluteValue=h.abs=function(){var e=new O(this);return e.s<0&&(e.s=1),e},h.comparedTo=function(e,t){return compare(this,new O(e,t))},h.decimalPlaces=h.dp=function(e,t){var n,r,i,o=this;if(null!=e)return intCheck(e,0,MAX),null==t?t=g:intCheck(t,0,8),B(new O(o),e+o.e+1,t);if(!(n=o.c))return null;if(r=((i=n.length-1)-bitFloor(this.e/LOG_BASE))*LOG_BASE,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},h.dividedBy=h.div=function(e,n){return t(this,new O(e,n),m,g)},h.dividedToIntegerBy=h.idiv=function(e,n){return t(this,new O(e,n),0,1)},h.exponentiatedBy=h.pow=function(e,t){var n,r,i,o,s,a,l,c,u=this;if((e=new O(e)).c&&!e.isInteger())throw Error(bignumberError+"Exponent not an integer: "+T(e));if(null!=t&&(t=new O(t)),s=e.e>14,!u.c||!u.c[0]||1==u.c[0]&&!u.e&&1==u.c.length||!e.c||!e.c[0])return c=new O(Math.pow(+T(u),s?e.s*(2-isOdd(e)):+T(e))),t?c.mod(t):c;if(a=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new O(NaN);(r=!a&&u.isInteger()&&t.isInteger())&&(u=u.mod(t))}else{if(e.e>9&&(u.e>0||u.e<-1||(0==u.e?u.c[0]>1||s&&u.c[1]>=24e7:u.c[0]<8e13||s&&u.c[0]<=9999975e7)))return o=u.s<0&&isOdd(e)?-0:0,u.e>-1&&(o=1/o),new O(a?1/o:o);E&&(o=mathceil(E/LOG_BASE+2))}for(s?(n=new O(.5),a&&(e.s=1),l=isOdd(e)):l=(i=Math.abs(+T(e)))%2,c=new O(f);;){if(l){if(!(c=c.times(u)).c)break;o?c.c.length>o&&(c.c.length=o):r&&(c=c.mod(t))}if(i){if(0===(i=mathfloor(i/2)))break;l=i%2}else if(B(e=e.times(n),e.e+1,1),e.e>14)l=isOdd(e);else{if(0===(i=+T(e)))break;l=i%2}u=u.times(u),o?u.c&&u.c.length>o&&(u.c.length=o):r&&(u=u.mod(t))}return r?c:(a&&(c=f.div(c)),t?c.mod(t):o?B(c,E,g,undefined):c)},h.integerValue=function(e){var t=new O(this);return null==e?e=g:intCheck(e,0,8),B(t,t.e+1,e)},h.isEqualTo=h.eq=function(e,t){return 0===compare(this,new O(e,t))},h.isFinite=function(){return!!this.c},h.isGreaterThan=h.gt=function(e,t){return compare(this,new O(e,t))>0},h.isGreaterThanOrEqualTo=h.gte=function(e,t){return 1===(t=compare(this,new O(e,t)))||0===t},h.isInteger=function(){return!!this.c&&bitFloor(this.e/LOG_BASE)>this.c.length-2},h.isLessThan=h.lt=function(e,t){return compare(this,new O(e,t))<0},h.isLessThanOrEqualTo=h.lte=function(e,t){return-1===(t=compare(this,new O(e,t)))||0===t},h.isNaN=function(){return!this.s},h.isNegative=function(){return this.s<0},h.isPositive=function(){return this.s>0},h.isZero=function(){return!!this.c&&0==this.c[0]},h.minus=function(e,t){var n,r,i,o,s=this,a=s.s;if(t=(e=new O(e,t)).s,!a||!t)return new O(NaN);if(a!=t)return e.s=-t,s.plus(e);var l=s.e/LOG_BASE,c=e.e/LOG_BASE,u=s.c,h=e.c;if(!l||!c){if(!u||!h)return u?(e.s=-t,e):new O(h?s:NaN);if(!u[0]||!h[0])return h[0]?(e.s=-t,e):new O(u[0]?s:3==g?-0:0)}if(l=bitFloor(l),c=bitFloor(c),u=u.slice(),a=l-c){for((o=a<0)?(a=-a,i=u):(c=l,i=h),i.reverse(),t=a;t--;i.push(0));i.reverse()}else for(r=(o=(a=u.length)<(t=h.length))?a:t,a=t=0;t<r;t++)if(u[t]!=h[t]){o=u[t]<h[t];break}if(o&&(i=u,u=h,h=i,e.s=-e.s),(t=(r=h.length)-(n=u.length))>0)for(;t--;u[n++]=0);for(t=BASE-1;r>a;){if(u[--r]<h[r]){for(n=r;n&&!u[--n];u[n]=t);--u[n],u[r]+=BASE}u[r]-=h[r]}for(;0==u[0];u.splice(0,1),--c);return u[0]?x(e,u,c):(e.s=3==g?-1:1,e.c=[e.e=0],e)},h.modulo=h.mod=function(e,n){var r,i,o=this;return e=new O(e,n),!o.c||!e.s||e.c&&!e.c[0]?new O(NaN):!e.c||o.c&&!o.c[0]?new O(o):(9==w?(i=e.s,e.s=1,r=t(o,e,0,3),e.s=i,r.s*=i):r=t(o,e,0,w),(e=o.minus(r.times(e))).c[0]||1!=w||(e.s=o.s),e)},h.multipliedBy=h.times=function(e,t){var n,r,i,o,s,a,l,c,u,h,f,m,g,d,p,b=this,A=b.c,S=(e=new O(e,t)).c;if(!(A&&S&&A[0]&&S[0]))return!b.s||!e.s||A&&!A[0]&&!S||S&&!S[0]&&!A?e.c=e.e=e.s=null:(e.s*=b.s,A&&S?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=bitFloor(b.e/LOG_BASE)+bitFloor(e.e/LOG_BASE),e.s*=b.s,(l=A.length)<(h=S.length)&&(g=A,A=S,S=g,i=l,l=h,h=i),i=l+h,g=[];i--;g.push(0));for(d=BASE,p=SQRT_BASE,i=h;--i>=0;){for(n=0,f=S[i]%p,m=S[i]/p|0,o=i+(s=l);o>i;)n=((c=f*(c=A[--s]%p)+(a=m*c+(u=A[s]/p|0)*f)%p*p+g[o]+n)/d|0)+(a/p|0)+m*u,g[o--]=c%d;g[o]=n}return n?++r:g.splice(0,1),x(e,g,r)},h.negated=function(){var e=new O(this);return e.s=-e.s||null,e},h.plus=function(e,t){var n,r=this,i=r.s;if(t=(e=new O(e,t)).s,!i||!t)return new O(NaN);if(i!=t)return e.s=-t,r.minus(e);var o=r.e/LOG_BASE,s=e.e/LOG_BASE,a=r.c,l=e.c;if(!o||!s){if(!a||!l)return new O(i/0);if(!a[0]||!l[0])return l[0]?e:new O(a[0]?r:0*i)}if(o=bitFloor(o),s=bitFloor(s),a=a.slice(),i=o-s){for(i>0?(s=o,n=l):(i=-i,n=a),n.reverse();i--;n.push(0));n.reverse()}for((i=a.length)-(t=l.length)<0&&(n=l,l=a,a=n,t=i),i=0;t;)i=(a[--t]=a[t]+l[t]+i)/BASE|0,a[t]=BASE===a[t]?0:a[t]%BASE;return i&&(a=[i].concat(a),++s),x(e,a,s)},h.precision=h.sd=function(e,t){var n,r,i,o=this;if(null!=e&&e!==!!e)return intCheck(e,1,MAX),null==t?t=g:intCheck(t,0,8),B(new O(o),e,t);if(!(n=o.c))return null;if(r=(i=n.length-1)*LOG_BASE+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&o.e+1>r&&(r=o.e+1),r},h.shiftedBy=function(e){return intCheck(e,-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER),this.times("1e"+e)},h.squareRoot=h.sqrt=function(){var e,n,r,i,o,s=this,a=s.c,l=s.s,c=s.e,u=m+4,h=new O("0.5");if(1!==l||!a||!a[0])return new O(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);if(0==(l=Math.sqrt(+T(s)))||l==1/0?(((n=coeffToString(a)).length+c)%2==0&&(n+="0"),l=Math.sqrt(+n),c=bitFloor((c+1)/2)-(c<0||c%2),r=new O(n=l==1/0?"5e"+c:(n=l.toExponential()).slice(0,n.indexOf("e")+1)+c)):r=new O(l+""),r.c[0])for((l=(c=r.e)+u)<3&&(l=0);;)if(o=r,r=h.times(o.plus(t(s,o,u,1))),coeffToString(o.c).slice(0,l)===(n=coeffToString(r.c)).slice(0,l)){if(r.e<c&&--l,"9999"!=(n=n.slice(l-3,l+1))&&(i||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(B(r,r.e+m+2,1),e=!r.times(r).eq(s));break}if(!i&&(B(o,o.e+m+2,0),o.times(o).eq(s))){r=o;break}u+=4,l+=4,i=1}return B(r,r.e+m+1,g,e)},h.toExponential=function(e,t){return null!=e&&(intCheck(e,0,MAX),e++),P(this,e,t,1)},h.toFixed=function(e,t){return null!=e&&(intCheck(e,0,MAX),e=e+this.e+1),P(this,e,t)},h.toFormat=function(e,t,n){var r,i=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=v;else if("object"!=typeof n)throw Error(bignumberError+"Argument not an object: "+n);if(r=i.toFixed(e,t),i.c){var o,s=r.split("."),a=+n.groupSize,l=+n.secondaryGroupSize,c=n.groupSeparator||"",u=s[0],h=s[1],f=i.s<0,m=f?u.slice(1):u,g=m.length;if(l&&(o=a,a=l,l=o,g-=o),a>0&&g>0){for(o=g%a||a,u=m.substr(0,o);o<g;o+=a)u+=c+m.substr(o,a);l>0&&(u+=c+m.slice(o)),f&&(u="-"+u)}r=h?u+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):u}return(n.prefix||"")+r+(n.suffix||"")},h.toFraction=function(e){var n,r,i,o,s,a,l,c,u,h,m,d,p=this,b=p.c;if(null!=e&&(!(l=new O(e)).isInteger()&&(l.c||1!==l.s)||l.lt(f)))throw Error(bignumberError+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+T(l));if(!b)return new O(p);for(n=new O(f),u=r=new O(f),i=c=new O(f),d=coeffToString(b),s=n.e=d.length-p.e-1,n.c[0]=POWS_TEN[(a=s%LOG_BASE)<0?LOG_BASE+a:a],e=!e||l.comparedTo(n)>0?s>0?n:u:l,a=A,A=1/0,l=new O(d),c.c[0]=0;h=t(l,n,0,1),1!=(o=r.plus(h.times(i))).comparedTo(e);)r=i,i=o,u=c.plus(h.times(o=u)),c=o,n=l.minus(h.times(o=n)),l=o;return o=t(e.minus(r),i,0,1),c=c.plus(o.times(u)),r=r.plus(o.times(i)),c.s=u.s=p.s,m=t(u,i,s*=2,g).minus(p).abs().comparedTo(t(c,r,s,g).minus(p).abs())<1?[u,i]:[c,r],A=a,m},h.toNumber=function(){return+T(this)},h.toPrecision=function(e,t){return null!=e&&intCheck(e,1,MAX),P(this,e,t,2)},h.toString=function(e){var t,r=this,i=r.s,o=r.e;return null===o?i?(t="Infinity",i<0&&(t="-"+t)):t="NaN":(null==e?t=o<=d||o>=p?toExponential(coeffToString(r.c),o):toFixedPoint(coeffToString(r.c),o,"0"):10===e&&C?t=toFixedPoint(coeffToString((r=B(new O(r),m+o+1,g)).c),r.e,"0"):(intCheck(e,2,y.length,"Base"),t=n(toFixedPoint(coeffToString(r.c),o,"0"),10,e,i,!0)),i<0&&r.c[0]&&(t="-"+t)),t},h.valueOf=h.toJSON=function(){return T(this)},h._isBigNumber=!0,h[Symbol.toStringTag]="BigNumber",h[Symbol.for("nodejs.util.inspect.custom")]=h.valueOf,null!=e&&O.set(e),O}function bitFloor(e){var t=0|e;return e>0||e===t?t:t-1}function coeffToString(e){for(var t,n,r=1,i=e.length,o=e[0]+"";r<i;){for(t=e[r++]+"",n=LOG_BASE-t.length;n--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function compare(e,t){var n,r,i=e.c,o=t.c,s=e.s,a=t.s,l=e.e,c=t.e;if(!s||!a)return null;if(n=i&&!i[0],r=o&&!o[0],n||r)return n?r?0:-a:s;if(s!=a)return s;if(n=s<0,r=l==c,!i||!o)return r?0:!i^n?1:-1;if(!r)return l>c^n?1:-1;for(a=(l=i.length)<(c=o.length)?l:c,s=0;s<a;s++)if(i[s]!=o[s])return i[s]>o[s]^n?1:-1;return l==c?0:l>c^n?1:-1}function intCheck(e,t,n,r){if(e<t||e>n||e!==mathfloor(e))throw Error(bignumberError+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function isOdd(e){var t=e.c.length-1;return bitFloor(e.e/LOG_BASE)==t&&e.c[t]%2!=0}function toExponential(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function toFixedPoint(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(++t>(r=e.length)){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var BigNumber=clone();class Float{constructor(e,t,n,r){Object.assign(this,{is_negative:e,exponent:n,is_normalized:r,mantissa:t}),this.ROUNDING=6}asNumber(){return this.exponent===this.RESERVED?new BigNumber(this.reservedNumber()):new BigNumber(this.is_normalized?1:0).plus(this.mantissa).times(this.is_negative?-1:1).times(new BigNumber(2).pow(this.exponent-this.BIAS))}toString(){return this.asNumber().round(this.ROUNDING).toString()}}class Float80 extends Float{get BIAS(){return 16383}get RESERVED(){return 32767}static fromBytes(e,t=!1){t||(e=Array.from(e).reverse());const n=Boolean(128&e[9]),r=(e[9]<<1&255)<<7|e[8],i=Boolean(128&e[7]);e[7]=127&e[7];const o=e.slice(0,8).reverse().map((e=>e.toString(2).padStart(8,"0"))).join("").substr(1),s=new BigNumber("0."+o,2);return new Float80(n,s,r,i)}reservedNumber(){return(this.is_negative?"-":"")+(this.mantissa.isZero()?"Infinity":"NaN")}}function decodeSample(e){let t=0;128&(e^=85)&&(e&=-129,t=-1);let n=4+((240&e)>>4),r=0;return r=4!=n?1<<n|(15&e)<<n-4|1<<n-5:e<<1|1,r=0===t?r:-r,8*r*-1}function decode(e){let t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=decodeSample(e[n]);return t}const decodeTable=[0,132,396,924,1980,4092,8316,16764];function decodeSample$1(e){let t,n,r,i;return t=128&(e=~e),n=e>>4&7,r=15&e,i=decodeTable[n]+(r<<n+3),0!=t&&(i=-i),i}function decode$1(e){let t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=decodeSample$1(e[n]);return t}async function parse$2(e){for(;e.idx<e.dv.byteLength-8;){const t=readChunk(e);switch(t.name){case"FVER":e.versionTimestamp=getUint32(e),log("Apple Version Timestamp: "+new Date(1e3*e.versionTimestamp-20828484e5).toLocaleString("de-DE",{dateStyle:"medium",timeStyle:"medium"}));break;case"COMM":log("COMM chunk size: "+t.size);const n=e.idx+t.size;e.comm={numChannels:getInt16(e),numSampleFrames:getUint32(e),sampleSize:getInt16(e),sampleRate:getIEEE754(e)},e.idx<n&&(e.comm.compressionType=getString(e,4)),e.idx<n&&(e.comm.compressionName=getString(e,4)),log("numChannels: "+e.comm.numChannels),log("numSampleFrames: "+e.comm.numSampleFrames),log("sampleSize = Bits: "+e.comm.sampleSize),log("sampleRate: "+e.comm.sampleRate),e.comm.compressionType&&log("compressionType: "+e.comm.compressionType),e.channels=e.comm.numChannels,e.sampleRate=e.comm.sampleRate,e.bits=e.comm.sampleSize;break;case"SSND":if(log("SSND chunk size: "+t.size),e.ssnd={offset:getUint32(e),blockSize:getUint32(e)},e.comm.compressionType&&"NONE"!=e.comm.compressionType){const n=new Uint8Array(t.size);n.set(new Uint8Array(e.dv.buffer).slice(e.idx,e.idx+t.size)),"alaw"==e.comm.compressionType&&(e.data=decode(n)),"ulaw"==e.comm.compressionType&&(e.data=decode$1(n)),e.idx+=t.size}else if(8===e.bits)e.data=new Int8Array(t.size),e.data.set(new Int8Array(e.dv.buffer).slice(e.idx,e.idx+t.size)),e.idx+=t.size;else if(16===e.bits){e.data=[];for(let n=0;n<t.size/2;n++)e.data.push(getInt16(e));e.data=new Int16Array(e.data)}else if(24===e.bits){e.data=[];for(let n=0;n<t.size/3;n++)e.data.push(getInt24(e));e.data=new Int32Array(e.data)}else if(32===e.bits){e.data=[];for(let n=0;n<t.size/4;n++)e.data.push(getInt32(e));e.data=new Int32Array(e.data)}break;default:processCommonChunks(e,t)}}e.comm?(prepareChannels$1(e),await initContext(e),e.play=t=>{play(e,t)},e.stop=()=>{stop(e)},e.pause=()=>{pause(e)},e.resume=()=>{resume(e)},e.getPosition=()=>getPosition(e),e.setPosition=t=>{setPosition(e,t)}):e.handleError("Missing COMM chunk. This is not a valid AIFF file.")}function prepareChannels$1(e){e.ch=[];for(let t=0;t<e.channels;t++)e.ch.push([]);for(let t=0;t<e.data.length;t++){let n=e.data[t];8==e.bits&&(n/=128),16==e.bits&&(n/=32768),24==e.bits&&(n/=2147483648),32==e.bits&&(n/=2147483648),e.ch[t%e.channels].push(n)}}function getIEEE754(e){let t=[];for(let n=0;n<10;n++)t.push(getUint8(e));return Float80.fromBytes(t).asNumber().toNumber()}async function parse$3(e){let t=readChunk(e);if("PRHD"===t.name)for(log("PRHD chunk size: "+t.size),e.idx+=t.size;e.idx<e.dv.byteLength-8;){if(t=readChunk(e),"PALT"===t.name){log("PALT chunk size: "+t.size);const n=1*e.idx;e.PALT={asso:[],cols:[],map:{},mapCols:{}};let r=getInt16(e);for(;-1!=r;)r=getInt16(e);for(r=0,e.idx=n+84;-1!=r;)r<0&&(r+=264),e.PALT.asso.push(r),r=getInt16(e);for(log("ColAsso: "+JSON.stringify(e.PALT.asso)),r=0,e.idx=n+146;-1!=r;){const t=getUint8(e);e.idx++;const n=getUint8(e);e.idx++;const i=getUint8(e);e.idx++,e.PALT.cols[r]="#"+t.toString(16).padStart(2,0)+n.toString(16).padStart(2,0)+i.toString(16).padStart(2,0),r=getInt16(e)}log("Colors: "+JSON.stringify(e.PALT.cols));const i=["background","text","brightEdges","darkEdges","activeWindowTitleBars","activeWindowTitles","","importantText","menuText","menuBackground","menuDarkEdges","menuBrightEdges"];for(let t=0;t<e.PALT.asso.length&&t<i.length;t++)i[t]&&(e.PALT.map[i[t]]=e.PALT.asso[t],e.PALT.asso[t]<e.PALT.cols.length&&(e.PALT.mapCols[i[t]]=e.PALT.cols[e.PALT.asso[t]]));if(log("Mapping indexes: "+JSON.stringify(e.PALT.map)),log("Mapping colors: "+JSON.stringify(e.PALT.mapCols)),t.size>400){e.PALT.os4cols=[],e.PALT.os4colsEna=[],e.idx=n+400;let t=0;for(;t<256;)e.PALT.os4cols.push("#"+getUint8(e).toString(16).padStart(2,0)+getUint8(e).toString(16).padStart(2,0)+getUint8(e).toString(16).padStart(2,0)),t++;for(log("OS4 Colors: "+JSON.stringify(e.PALT.os4cols)),t=0;t<256;)e.PALT.os4colsEna.push(1==getUint8(e)),t++;log("OS4 Color enabled: "+JSON.stringify(e.PALT.os4colsEna))}return}processCommonChunks(e,t)}else e.handleError("Missing PRHD chunk. This is not a valid PREF file.")}class IFF{constructor(e,t,n,r){this.idx=0,this.cbOnLoad=t,this.cbOnError=n,this.cbOnEnd=r,"string"==typeof e&&this.load(e),"object"==typeof e&&this.parse(e)}load(e){fetch(e).then((e=>e.arrayBuffer())).then((e=>{log("File loaded"),this.parse(e)})).catch((e=>{this.handleError(e)}))}async parse(e){this.dv=new DataView(e);const t=getString(this,4);if(-1!==["FORM","LIST","CAT "].indexOf(t))if("FORM"===t){switch(this.group=t,this.formSize=getUint32(this),log(this.group+" chunk size = "+this.formSize),this.formSize+8!==this.dv.byteLength&&log("FORM size does not match file size: "+this.formSize+"8 !== "+this.dv.byteLength),this.subType=getString(this,4),this.subType){case"ILBM":case"PBM ":await parse(this);break;case"SMUS":break;case"8SVX":case"16SV":this.bits="8SVX"==this.subType?8:16,await parse$1(this);break;case"AIFF":case"AIFC":await parse$2(this);break;case"PREF":await parse$3(this);break;default:console.log("Not yet supported type: "+this.subType)}this.cbOnLoad()}else this.handleError("Only FORM group is supported.");else this.handleError("This is not an IFF-85 file.")}handleError(e){if(log(e),this.cbOnError){const t="object"==typeof e?e:new Error(e);t.sender=this,this.cbOnError(t)}else console.error(e)}}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},window.IFF=IFF;export{IFF};