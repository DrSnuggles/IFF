function log(e){console.log("IFF:",e);const t=document.getElementById("info");t&&(t.innerHTML+=e+"<br/>")}function getString(e,t){let n=(new TextDecoder).decode(e.dv.buffer.slice(e.idx,e.idx+t));return n=n.replace(/\u0000/g,""),e.idx+=t,n}function getUint8(e){const t=e.dv.getUint8(e.idx);return e.idx++,t}function getUint16(e){const t=e.dv.getUint16(e.idx,!1);return e.idx+=2,t}function getUint24(e){return(getUint8(e)<<24)+(getUint8(e)<<16)+(getUint8(e)<<8)}function getUint32(e){const t=e.dv.getUint32(e.idx,!1);return e.idx+=4,t}function getInt16(e){const t=e.dv.getInt16(e.idx,!1);return e.idx+=2,t}function getInt24(e){return getUint24(e)|0}function getInt32(e){const t=e.dv.getInt32(e.idx,!1);return e.idx+=4,t}function readChunk(e){return{name:getString(e,4),size:getInt32(e)}}function processCommonChunks(e,t){switch(t.name){case"(c) ":e.copyright=getString(e,t.size),log("Copyright: "+e.copyright);break;case"ANNO":e.annotation=getString(e,t.size),log("Annotation: "+e.annotation);break;case"AUTH":e.author=getString(e,t.size),log("Author: "+e.author);break;case"CHRS":e.characterString=getString(e,t.size),log("CharString: "+e.characterString);break;case"CSET":e.characterSet=getString(e,t.size),log("CharSet: "+e.characterSet);break;case"FTXT":e.formattedText=getString(e,t.size),log("FTXT: "+e.formattedText);break;case"FVER":e.amigaOS=getString(e,t.size),log("AmigaOS: "+e.amigaOS);break;case"HLID":e.hotLink=getString(e,t.size),log("HotlinkID: "+e.hotLink);break;case"NAME":e.name=getString(e,t.size),log("Name: "+e.name);break;case"OCMP":e.computer=getString(e,t.size),log("Computer: "+e.computer);break;case"OCPU":e.cpu=getString(e,t.size),log("CPU: "+e.cpu);break;case"OPGM":e.pgm=getString(e,t.size),log("Program: "+e.pgm);break;case"OSN ":e.sn=getString(e,t.size),log("Serial#: "+e.sn);break;case"PTXT":e.privText=getString(e,t.size),log("PrivateText: "+e.privText);break;case"TEXT":e.text=getString(e,t.size),log("Text: "+e.text);break;case"UNAM":e.userName=getString(e,t.size),log("Username: "+e.userName);break;case"VERS":e.version=getString(e,t.size),log("Version: "+e.version);break;default:log("Skipping chunk: "+t.name),e.idx+=t.size>0?t.size:-7}}function unpack_ByteRun1(e){const t=new Int8Array(e),n=[];let r=0;for(;r<t.length;){var i=t[r++];if(i>=0&&i<=127)for(let e=0;e<i+1;e++)n.push(t[r++]);else if(i>=-127&&i<=-1){var o=e[r++];for(let e=0;e<1-i;e++)n.push(o)}}return n}async function parse(e){for(e.ctbl=!1,e.sham=!1;e.idx<e.dv.byteLength-8;){const t=readChunk(e);switch(t.name){case"BODY":log("BODY chunk size: "+t.size),e.data=new Uint8Array(t.size),e.data.set(new Uint8Array(e.dv.buffer).slice(e.idx,e.idx+t.size)),e.idx+=t.size,e.bmhd.compression&&(e.data=unpack_ByteRun1(e.data));break;case"BMHD":log("BMHD chunk size: "+t.size),e.bmhd={w:getUint16(e),h:getUint16(e),x:getInt16(e),y:getInt16(e),nPlanes:getUint8(e),masking:getUint8(e),compression:getUint8(e),pad1:getUint8(e),transparentColor:getUint16(e),xAspect:getUint8(e),yAspect:getUint8(e),pageWidth:getInt16(e),pageHeight:getInt16(e)},log("w: "+e.bmhd.w),log("h: "+e.bmhd.h),log("x: "+e.bmhd.x),log("y: "+e.bmhd.y),log("nPlanes: "+e.bmhd.nPlanes),log("masking: "+e.bmhd.masking),log("compression: "+e.bmhd.compression),log("transparentColor: "+e.bmhd.transparentColor),log("xAspect: "+e.bmhd.xAspect),log("yAspect: "+e.bmhd.yAspect),log("pageWidth: "+e.bmhd.pageWidth),log("pageHeight: "+e.bmhd.pageHeight);break;case"CMAP":log("CMAP chunk size: "+t.size),e.cmap=[],e.pal=[];for(let n=0;n<t.size;n+=3){const t=getUint8(e),n=getUint8(e),r=getUint8(e);e.cmap.push([t,n,r,255]),e.pal.push(t,n,r)}for(e.cmap_bits=0;e.cmap.length>1<<e.cmap_bits;)e.cmap_bits++;isCMAPScaled(e)||scaleCMAP(e),e.cmap_overlay=new Array(e.cmap.length),log("2^"+e.bmhd.nPlanes+"="+Math.pow(2,e.bmhd.nPlanes)+" ?= "+e.cmap.length),Math.pow(2,e.bmhd.nPlanes)!==e.cmap.length&&log("num colors in cmap do not match bitplanes");break;case"CAMG":if(log("CAMG chunk size: "+t.size),e.mode={BPLCON1:getUint16(e),BPLCON0:getUint16(e)},e.mode={...e.mode,HIRES:32768&e.mode.BPLCON0,BPU:(28672&e.mode.BPLCON0)>>12,HAM:2048&e.mode.BPLCON0,DPF:1024&e.mode.BPLCON0,COLOR:512&e.mode.BPLCON0,GAUD:256&e.mode.BPLCON0,UHRES:128&e.mode.BPLCON0,SHRES:64&e.mode.BPLCON0,BYPASS:32&e.mode.BPLCON0,BPU3:16&e.mode.BPLCON0,LPEN:8&e.mode.BPLCON0,LACE:4&e.mode.BPLCON0,ERSY:2&e.mode.BPLCON0,ECSENA:1&e.mode.BPLCON0,EHB:128&e.mode.BPLCON0},e.mode.ehb&&e.cmap_bits==e.bmhd.nPlanes&&(log("EHB detected"),f.cmap_bits--,f.cmap.length=f.cmap.length>>1,f.cmap_overlay.length=f.cmap.length),e.mode.HAM&&e.cmap_bits>e.bmhd.nPlanes-2){const t=e.cmap_bits-e.bmhd.nPlanes+2;log("HAM delta: "+t),e.cmap_bits-=t,e.cmap.length=e.cmap.length>>t,e.cmap_overlay.length=e.cmap.length}break;case"CRNG":log("CRNG chunk size: "+t.size),e.crng||(e.crng=[]);let n=[];for(let r=0;r<t.size;r++)n.push(getUint8(e));e.crng.push(n);break;case"CTBL":log("CTBL chunk size: "+t.size);const r=Math.pow(2,e.bmhd.nPlanes);e.ctbl=[],log("CTBL palettes: "+t.size/2/r),e.bmhd.h!=t.size/2/r&&log("CTBL palettes do not match height");for(let n=0;n<t.size/2;n++){const t=getUint16(e),i=Math.floor(n/r),o=n%r;0==o&&e.ctbl.push([]),e.ctbl[i].push([]),e.ctbl[i][o].push(padTo8bits(t>>8&15,4)),e.ctbl[i][o].push(padTo8bits(t>>4&15,4)),e.ctbl[i][o].push(padTo8bits(15&t,4)),e.ctbl[i][o].push(255)}break;case"SHAM":e.sham=[];const i=16,o=getUint16(e);log("SHAM chunk size: "+t.size+" version: "+o),log("SHAM palettes: "+(t.size-2)/2/i),e.bmhd.h!=(t.size-2)/2/i&&log("SHAM palettes do not match height");for(let n=0;n<(t.size-2)/2;n++){const t=getUint16(e),r=Math.floor(n/i),o=n%i;0==o&&e.sham.push([]),e.sham[r].push([]),e.sham[r][o].push(padTo8bits(t>>8&15,4)),e.sham[r][o].push(padTo8bits(t>>4&15,4)),e.sham[r][o].push(padTo8bits(15&t,4)),e.sham[r][o].push(255)}break;case"DPI ":case"PCHG":case"PDDP":e.idx+=t.size;break;default:processCommonChunks(e,t)}}e.bmhd.pixBuf=bitPlaneToPixBuffer(e),e.show=t=>{showILBM(e,t)}}function padTo8bits(e,t){for(var n=0,r=8-t;r>=0;r-=t)n|=e<<r;return n}function isCMAPScaled(e){var t=(1<<e.cmap_bits)-1;for(let n=0;n<e.cmap.length;n++)for(let r=0;r<3;r++){if(e.cmap[n][r]&t)return!0}return!1}function scaleCMAP(e){for(let n=0;n<e.cmap.length;n++)for(let r=0;r<3;r++){var t=e.cmap[n][r]>>8-e.cmap_bits;e.cmap[n][r]=padTo8bits(t,e.cmap_bits)}log("CMAP scaled")}function showILBM(e,t){0!=e.bmhd.yAspect?e.bmhd.ratio=e.bmhd.xAspect/e.bmhd.yAspect:e.bmhd.ratio=1,e.bmhd.eff_w=e.bmhd.w*Math.max(e.bmhd.ratio,1),e.bmhd.eff_h=e.bmhd.h/Math.min(e.bmhd.ratio,1),t.width=e.bmhd.eff_w,t.height=e.bmhd.eff_h;var n=document.createElement("canvas");n.width=e.bmhd.w,n.height=e.bmhd.h;for(var r=n.getContext("2d"),i=r.createImageData(e.bmhd.w,e.bmhd.h),o=0,s=[0,0,0,255];o<e.bmhd.pixBuf.length;){s=resolvePixels(e,e.bmhd.pixBuf[o],s,Math.floor(o/e.bmhd.w),o%e.bmhd.w);for(let e=0;e<4;e++)i.data[4*o+e]=s[e];o++}r.putImageData(i,0,0),t.getContext("2d").drawImage(n,0,0,e.bmhd.w,e.bmhd.h,0,0,e.bmhd.eff_w,e.bmhd.eff_h)}function resolveHAMPixel(e,t,n){var r=t>>e.cmap_bits&3,i=padTo8bits(t%e.cmap.length,e.cmap_bits),o=[n[0],n[1],n[2],255];return 1==r?o[2]=i:2==r?o[0]=i:o[1]=i,o}function resolveEHBPixel(e,t){var n=e.cmap[t%e.cmap.length];return[n[0]>>1,n[1]>>1,n[2]>>1,255]}function resolveRGB24Pixel(e){return[(16711680&e)>>16,(65280&e)>>8,255&e,255]}function resolvePixels(e,t,n,r,i){return null==t&&(t=e.bmhd.transparentColor),2==e.bmhd.masking&&e.bmhd.transparentColor,void 0===e.cmap&&24==e.bmhd.nPlanes?resolveRGB24Pixel(t):t<e.cmap.length?e.sham?e.sham[r][t]:e.ctbl?e.ctbl[r][t]:e.cmap[t]:e.mode.HAM?(0==i&&(n=[0,0,0,255]),resolveHAMPixel(e,t,n)):e.mode.ehb?resolveEHBPixel(e,t):(console.log("oops no color resolve found"),[0,0,0,0])}function bitPlaneToPixBuffer(e){var t=e.bmhd.w+15>>4<<1,n=new Array(e.bmhd.w*e.bmhd.h).fill(0),r=e.bmhd.nPlanes;1==e.bmhd.masking&&(r+=1);for(let l=0;l<e.bmhd.h;l++)for(let c=0;c<r;c++){var i=1<<c;for(let h=0;h<t;h++){var o=l*r*t+c*t+h,s=e.data[o];for(let t=0;t<8;t++){if(s&1<<7-t){var a=8*h+t;n[l*e.bmhd.w+a]|=i}}}}return n}function unpack_Delta(e,t){const n="FDC"===t?[-34,-21,-13,-8,-5,-3,-2,-1,0,1,2,3,5,8,13,21]:[-128,-64,-32,-16,-8,-4,-2,-1,0,1,2,4,8,16,32,64],r=[];r.push(e[1]);for(let t=0;t<2*(e.length-2);++t){const i=e[Math.floor(t/2)+2],o=t%2==0?i>>4:15&i;r.push(r[t]+n[o]&255)}return r}function unpack_ADPCM(e,t,n){let r=Math.ceil(e.length/3),i=65535&n,o=(4294901760&n)>>16,s=0;o||(o=5);let a=0;const l=[],c=[[14336,22016,0,0,0,0,0,0],[14746,15007,19732,26119,0,0,0,0],[13654,13654,14746,15007,16896,19732,26119,26119]],h=[0,1,3,7,15,31,63,127,255];for(;r--;){let n=24/t,r=e[a++]<<16|e[a++]<<8|e[a++];for(;n--;){let e=o>>1,a=r>>n*t,u=a&h[t-1];for(4!=t||15&a||(o=4);u--;)e+=o;s=o*c[t-2][a&h[t-1]],a&1<<t-1&&(e=-e),i=i+e&65535,o=s+8192>>14,o<5&&(o=5),e=i>>6,127<e?l.push(127):-128>e?l.push(-128):l.push(e)}}return l}function resample(e,t,n){const r=[],i=n/t,o=Math.floor(n/t),s=i-o;for(let t=0,n=0;t<e.length;t++){for(let n=0;n<o;n++)r.push(e[t]);n+=s,n>=1&&(r.push(e[t]),n-=1)}return r}async function initContext(e){stop(e);try{e.ctx=new AudioContext({sampleRate:e.sampleRate})}catch(t){log("Error on init new AudioContext() with samplerate "+e.sampleRate+": "+t),log("Retrying without specifying samplerate and using resample() instead."),e.ctx=new AudioContext}if(log("srcRate: "+e.sampleRate),log("destRate: "+e.ctx.sampleRate),e.sampleRate!==e.ctx.sampleRate)for(let t=0;t<e.channels;t++)e.ch[t]=resample(e.ch[t],e.sampleRate,e.ctx.sampleRate);await e.ctx.audioWorklet.addModule(URL.createObjectURL(new Blob(['class BufferPlayer extends AudioWorkletProcessor{constructor(){super(),this.port.onmessage=this.handleMessage_.bind(this),this.ch=[],this.frame=0}process(e,s,r){if(0==this.ch.length)return!0;if(-1==this.frame)return!0;for(let e=0;e<s[0][0].length;e++){for(let r=0;r<s[0].length;r++)s[0][r][e]=this.ch[r][this.frame];this.frame++,this.frame>=this.ch[0].length&&(this.frame=-1,this.port.postMessage({pos:-1}))}return!0}handleMessage_(e){e.data.ch&&(this.ch=e.data.ch)}}registerProcessor("bufferplayer-processor",BufferPlayer)'],{type:"application/javascript"}))),e.aw=new AudioWorkletNode(e.ctx,"bufferplayer-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[e.channels]}),e.aw.connect(e.ctx.destination),e.aw.port.onmessage=t=>{-1==t.data.pos&&stop(e)}}async function play(e){e.aw.port.postMessage({ch:e.ch})}function stop(e){e.aw&&e.ctx.close()}async function parse$1(e){let t=readChunk(e);if("VHDR"===t.name){for(log("VHDR chunk size: "+t.size),e.vhdr={oneShotHiSamples:getUint32(e),repeatHiSamples:getUint32(e),samplesPerHiCycle:getUint32(e),samplesPerSec:getUint16(e),ctOctave:getUint8(e),sCompression:getUint8(e),volume:getUint32(e)},log("oneShotHiSamples: "+e.vhdr.oneShotHiSamples),log("repeatHiSamples: "+e.vhdr.repeatHiSamples),log("samplesPerHiCycle: "+e.vhdr.samplesPerHiCycle),log("samplesPerSec: "+e.vhdr.samplesPerSec),log("ctOctave: "+e.vhdr.ctOctave),log("sCompression: "+e.vhdr.sCompression),log("volume: "+e.vhdr.volume),e.channels=1,e.sampleRate=e.vhdr.samplesPerSec,log("Bits: "+e.bits);e.idx<e.dv.byteLength-8;)switch(t=readChunk(e),t.name){case"BODY":if(log("BODY chunk size: "+t.size),0===e.vhdr.sCompression)if(8===e.bits)e.data=new Int8Array(t.size),e.data.set(new Int8Array(e.dv.buffer).slice(e.idx,e.idx+t.size));else{e.data=[];for(let n=0;n<t.size/2;n++)e.data.push(e.dv.getInt16(e.idx+2*n,!1));e.data=new Int16Array(e.data)}else{e.data=[];for(let n=0;n<e.channels;n++){const r=t.size/e.channels,i=new Uint8Array(r);i.set(new Uint8Array(e.dv.buffer).slice(e.idx+n*r,e.idx+(n+1)*r)),1==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_Delta(i,"FDC")]),2==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_Delta(i,"EDC")]),3==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_ADPCM(i,2,0)]),4==e.vhdr.sCompression&&(e.data=[...e.data,...unpack_ADPCM(i,3,0)])}e.data=new Int8Array(e.data)}e.idx+=t.size;break;case"CHAN":switch(log("CHAN chunk size: "+t.size),e.chan=getUint32(e),log("CHAN: "+e.chan),e.chan){case 6:e.channels=2;break;case 30:e.channels=4}log("channels: "+e.channels);break;case"PAN ":log("PAN chunk size: "+t.size),e.pan=getUint32(e);break;case"SEQN":log("SEQN chunk size: "+t.size),e.seqn=[];for(let n=0;n<t.size/8;n++)e.seqn.push({start:getUint32(e),end:getUint32(e)});break;case"FADE":log("FADE chunk size: "+t.size),f.fade=getUint32(e);break;case"ATAK":log("ATAK chunk size: "+t.size),e.atak=[];for(let n=0;n<t.size/6;n++)e.atak.push({duration:getUint32(e),dest:getUint32(e)});break;case"RLSE":log("RLSE chunk size: "+t.size),e.rlse=[];for(let n=0;n<t.size/6;n++)e.rlse.push({duration:getUint32(e),dest:getUint32(e)});break;default:processCommonChunks(e,t)}prepareChannels(e),await initContext(e),e.play=()=>{play(e)},e.stop=()=>{stop(e)}}else log("Missing VHDR chunk. This is not a valid SVX file")}function prepareChannels(e){e.ch=[];for(let t=0,n=0;t<e.channels;t++){const t=[];if(8==e.bits)for(let r=0;r<e.data.length/e.channels;r++)t.push(e.data[n++]/128);else for(let r=0;r<e.data.length/e.channels;r++)t.push(e.data[n++]/32768);e.ch.push(new Float32Array(t))}}var isNumeric=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,mathceil=Math.ceil,mathfloor=Math.floor,bignumberError="[BigNumber Error] ",tooManyDigits=bignumberError+"Number primitive has more than 15 significant digits: ",BASE=1e14,LOG_BASE=14,MAX_SAFE_INTEGER=9007199254740991,POWS_TEN=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],SQRT_BASE=1e7,MAX=1e9;function clone(e){var t,n,r,i,o,s,a,l,c,h,u=v.prototype={constructor:v,toString:null,valueOf:null},f=new v(1),g=20,m=4,p=-7,d=21,b=-1e7,S=1e7,A=!1,E=1,w=0,O={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},B="0123456789abcdefghijklmnopqrstuvwxyz",C=!0;function v(e,t){var i,o,s,a,l,c,h,u,f=this;if(!(f instanceof v))return new v(e,t);if(null==t){if(e&&!0===e._isBigNumber)return f.s=e.s,void(!e.c||e.e>S?f.c=f.e=null:e.e<b?f.c=[f.e=0]:(f.e=e.e,f.c=e.c.slice()));if((c="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(a=0,l=e;l>=10;l/=10,a++);return void(a>S?f.c=f.e=null:(f.e=a,f.c=[e]))}u=String(e)}else{if(!isNumeric.test(u=String(e)))return r(f,u,c);f.s=45==u.charCodeAt(0)?(u=u.slice(1),-1):1}(a=u.indexOf("."))>-1&&(u=u.replace(".","")),(l=u.search(/e/i))>0?(a<0&&(a=l),a+=+u.slice(l+1),u=u.substring(0,l)):a<0&&(a=u.length)}else{if(intCheck(t,2,B.length,"Base"),10==t&&C)return _(f=new v(e),g+f.e+1,m);if(u=String(e),c="number"==typeof e){if(0*e!=0)return r(f,u,c,t);if(f.s=1/e<0?(u=u.slice(1),-1):1,v.DEBUG&&u.replace(/^0\.0*|\./,"").length>15)throw Error(tooManyDigits+e)}else f.s=45===u.charCodeAt(0)?(u=u.slice(1),-1):1;for(i=B.slice(0,t),a=l=0,h=u.length;l<h;l++)if(i.indexOf(o=u.charAt(l))<0){if("."==o){if(l>a){a=h;continue}}else if(!s&&(u==u.toUpperCase()&&(u=u.toLowerCase())||u==u.toLowerCase()&&(u=u.toUpperCase()))){s=!0,l=-1,a=0;continue}return r(f,String(e),c,t)}c=!1,(a=(u=n(u,t,10,f.s)).indexOf("."))>-1?u=u.replace(".",""):a=u.length}for(l=0;48===u.charCodeAt(l);l++);for(h=u.length;48===u.charCodeAt(--h););if(u=u.slice(l,++h)){if(h-=l,c&&v.DEBUG&&h>15&&(e>MAX_SAFE_INTEGER||e!==mathfloor(e)))throw Error(tooManyDigits+f.s*e);if((a=a-l-1)>S)f.c=f.e=null;else if(a<b)f.c=[f.e=0];else{if(f.e=a,f.c=[],l=(a+1)%LOG_BASE,a<0&&(l+=LOG_BASE),l<h){for(l&&f.c.push(+u.slice(0,l)),h-=LOG_BASE;l<h;)f.c.push(+u.slice(l,l+=LOG_BASE));l=LOG_BASE-(u=u.slice(l)).length}else l-=h;for(;l--;u+="0");f.c.push(+u)}}else f.c=[f.e=0]}function y(e,t,n,r){var i,o,s,a,l;if(null==n?n=m:intCheck(n,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)l=coeffToString(e.c),l=1==r||2==r&&(s<=p||s>=d)?toExponential(l,s):toFixedPoint(l,s,"0");else if(o=(e=_(new v(e),t,n)).e,a=(l=coeffToString(e.c)).length,1==r||2==r&&(t<=o||o<=p)){for(;a<t;l+="0",a++);l=toExponential(l,o)}else if(t-=s,l=toFixedPoint(l,o,"0"),o+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=o-a)>0)for(o+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function k(e,t){for(var n,r,i=1,o=new v(e[0]);i<e.length;i++)(!(r=new v(e[i])).s||(n=compare(o,r))===t||0===n&&o.s===t)&&(o=r);return o}function x(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+n*LOG_BASE-1)>S?e.c=e.e=null:n<b?e.c=[e.e=0]:(e.e=n,e.c=t),e}function _(e,t,n,r){var i,o,s,a,l,c,h,u=e.c,f=POWS_TEN;if(u){e:{for(i=1,a=u[0];a>=10;a/=10,i++);if((o=t-i)<0)o+=LOG_BASE,s=t,l=u[c=0],h=mathfloor(l/f[i-s-1]%10);else if((c=mathceil((o+1)/LOG_BASE))>=u.length){if(!r)break e;for(;u.length<=c;u.push(0));l=h=0,i=1,s=(o%=LOG_BASE)-LOG_BASE+1}else{for(l=a=u[c],i=1;a>=10;a/=10,i++);h=(s=(o%=LOG_BASE)-LOG_BASE+i)<0?0:mathfloor(l/f[i-s-1]%10)}if(r=r||t<0||null!=u[c+1]||(s<0?l:l%f[i-s-1]),r=n<4?(h||r)&&(0==n||n==(e.s<0?3:2)):h>5||5==h&&(4==n||r||6==n&&(o>0?s>0?l/f[i-s]:0:u[c-1])%10&1||n==(e.s<0?8:7)),t<1||!u[0])return u.length=0,r?(t-=e.e+1,u[0]=f[(LOG_BASE-t%LOG_BASE)%LOG_BASE],e.e=-t||0):u[0]=e.e=0,e;if(0==o?(u.length=c,a=1,c--):(u.length=c+1,a=f[LOG_BASE-o],u[c]=s>0?mathfloor(l/f[i-s]%f[s])*a:0),r)for(;;){if(0==c){for(o=1,s=u[0];s>=10;s/=10,o++);for(s=u[0]+=a,a=1;s>=10;s/=10,a++);o!=a&&(e.e++,u[0]==BASE&&(u[0]=1));break}if(u[c]+=a,u[c]!=BASE)break;u[c--]=0,a=1}for(o=u.length;0===u[--o];u.pop());}e.e>S?e.c=e.e=null:e.e<b&&(e.c=[e.e=0])}return e}function N(e){var t,n=e.e;return null===n?e.toString():(t=coeffToString(e.c),t=n<=p||n>=d?toExponential(t,n):toFixedPoint(t,n,"0"),e.s<0?"-"+t:t)}return v.clone=clone,v.ROUND_UP=0,v.ROUND_DOWN=1,v.ROUND_CEIL=2,v.ROUND_FLOOR=3,v.ROUND_HALF_UP=4,v.ROUND_HALF_DOWN=5,v.ROUND_HALF_EVEN=6,v.ROUND_HALF_CEIL=7,v.ROUND_HALF_FLOOR=8,v.EUCLID=9,v.config=v.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(bignumberError+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(intCheck(n=e[t],0,MAX,t),g=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(intCheck(n=e[t],0,8,t),m=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(intCheck(n[0],-MAX,0,t),intCheck(n[1],0,MAX,t),p=n[0],d=n[1]):(intCheck(n,-MAX,MAX,t),p=-(d=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)intCheck(n[0],-MAX,-1,t),intCheck(n[1],1,MAX,t),b=n[0],S=n[1];else{if(intCheck(n,-MAX,MAX,t),!n)throw Error(bignumberError+t+" cannot be zero: "+n);b=-(S=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(bignumberError+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw A=!n,Error(bignumberError+"crypto unavailable");A=n}else A=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(intCheck(n=e[t],0,9,t),E=n),e.hasOwnProperty(t="POW_PRECISION")&&(intCheck(n=e[t],0,MAX,t),w=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(bignumberError+t+" not an object: "+n);O=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(bignumberError+t+" invalid: "+n);C="0123456789"==n.slice(0,10),B=n}}return{DECIMAL_PLACES:g,ROUNDING_MODE:m,EXPONENTIAL_AT:[p,d],RANGE:[b,S],CRYPTO:A,MODULO_MODE:E,POW_PRECISION:w,FORMAT:O,ALPHABET:B}},v.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!v.DEBUG)return!0;var t,n,r=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&i>=-MAX&&i<=MAX&&i===mathfloor(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%LOG_BASE)<1&&(t+=LOG_BASE),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=BASE||n!==mathfloor(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(bignumberError+"Invalid BigNumber: "+e)},v.maximum=v.max=function(){return k(arguments,-1)},v.minimum=v.min=function(){return k(arguments,1)},v.random=(i=9007199254740992,o=Math.random()*i&2097151?function(){return mathfloor(Math.random()*i)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,i,s,a=0,l=[],c=new v(f);if(null==e?e=g:intCheck(e,0,MAX),i=mathceil(e/LOG_BASE),A)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(i*=2));a<i;)(s=131072*t[a]+(t[a+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[a]=n[0],t[a+1]=n[1]):(l.push(s%1e14),a+=2);a=i/2}else{if(!crypto.randomBytes)throw A=!1,Error(bignumberError+"crypto unavailable");for(t=crypto.randomBytes(i*=7);a<i;)(s=281474976710656*(31&t[a])+1099511627776*t[a+1]+4294967296*t[a+2]+16777216*t[a+3]+(t[a+4]<<16)+(t[a+5]<<8)+t[a+6])>=9e15?crypto.randomBytes(7).copy(t,a):(l.push(s%1e14),a+=7);a=i/7}if(!A)for(;a<i;)(s=o())<9e15&&(l[a++]=s%1e14);for(i=l[--a],e%=LOG_BASE,i&&e&&(s=POWS_TEN[LOG_BASE-e],l[a]=mathfloor(i/s)*s);0===l[a];l.pop(),a--);if(a<0)l=[r=0];else{for(r=-1;0===l[0];l.splice(0,1),r-=LOG_BASE);for(a=1,s=l[0];s>=10;s/=10,a++);a<LOG_BASE&&(r-=LOG_BASE-a)}return c.e=r,c.c=l,c}),v.sum=function(){for(var e=1,t=arguments,n=new v(t[0]);e<t.length;)n=n.plus(t[e++]);return n},n=function(){var e="0123456789";function n(e,t,n,r){for(var i,o,s=[0],a=0,l=e.length;a<l;){for(o=s.length;o--;s[o]*=t);for(s[0]+=r.indexOf(e.charAt(a++)),i=0;i<s.length;i++)s[i]>n-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/n|0,s[i]%=n)}return s.reverse()}return function(r,i,o,s,a){var l,c,h,u,f,p,d,b,S=r.indexOf("."),A=g,E=m;for(S>=0&&(u=w,w=0,r=r.replace(".",""),p=(b=new v(i)).pow(r.length-S),w=u,b.c=n(toFixedPoint(coeffToString(p.c),p.e,"0"),10,o,e),b.e=b.c.length),h=u=(d=n(r,i,o,a?(l=B,e):(l=e,B))).length;0==d[--u];d.pop());if(!d[0])return l.charAt(0);if(S<0?--h:(p.c=d,p.e=h,p.s=s,d=(p=t(p,b,A,E,o)).c,f=p.r,h=p.e),S=d[c=h+A+1],u=o/2,f=f||c<0||null!=d[c+1],f=E<4?(null!=S||f)&&(0==E||E==(p.s<0?3:2)):S>u||S==u&&(4==E||f||6==E&&1&d[c-1]||E==(p.s<0?8:7)),c<1||!d[0])r=f?toFixedPoint(l.charAt(1),-A,l.charAt(0)):l.charAt(0);else{if(d.length=c,f)for(--o;++d[--c]>o;)d[c]=0,c||(++h,d=[1].concat(d));for(u=d.length;!d[--u];);for(S=0,r="";S<=u;r+=l.charAt(d[S++]));r=toFixedPoint(r,h,l.charAt(0))}return r}}(),t=function(){function e(e,t,n){var r,i,o,s,a=0,l=e.length,c=t%SQRT_BASE,h=t/SQRT_BASE|0;for(e=e.slice();l--;)a=((i=c*(o=e[l]%SQRT_BASE)+(r=h*o+(s=e[l]/SQRT_BASE|0)*c)%SQRT_BASE*SQRT_BASE+a)/n|0)+(r/SQRT_BASE|0)+h*s,e[l]=i%n;return a&&(e=[a].concat(e)),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,o,s,a){var l,c,h,u,f,g,m,p,d,b,S,A,E,w,O,B,C,y=r.s==i.s?1:-1,k=r.c,x=i.c;if(!(k&&k[0]&&x&&x[0]))return new v(r.s&&i.s&&(k?!x||k[0]!=x[0]:x)?k&&0==k[0]||!x?0*y:y/0:NaN);for(d=(p=new v(y)).c=[],y=o+(c=r.e-i.e)+1,a||(a=BASE,c=bitFloor(r.e/LOG_BASE)-bitFloor(i.e/LOG_BASE),y=y/LOG_BASE|0),h=0;x[h]==(k[h]||0);h++);if(x[h]>(k[h]||0)&&c--,y<0)d.push(1),u=!0;else{for(w=k.length,B=x.length,h=0,y+=2,(f=mathfloor(a/(x[0]+1)))>1&&(x=e(x,f,a),k=e(k,f,a),B=x.length,w=k.length),E=B,S=(b=k.slice(0,B)).length;S<B;b[S++]=0);C=x.slice(),C=[0].concat(C),O=x[0],x[1]>=a/2&&O++;do{if(f=0,(l=t(x,b,B,S))<0){if(A=b[0],B!=S&&(A=A*a+(b[1]||0)),(f=mathfloor(A/O))>1)for(f>=a&&(f=a-1),m=(g=e(x,f,a)).length,S=b.length;1==t(g,b,m,S);)f--,n(g,B<m?C:x,m,a),m=g.length,l=1;else 0==f&&(l=f=1),m=(g=x.slice()).length;if(m<S&&(g=[0].concat(g)),n(b,g,S,a),S=b.length,-1==l)for(;t(x,b,B,S)<1;)f++,n(b,B<S?C:x,S,a),S=b.length}else 0===l&&(f++,b=[0]);d[h++]=f,b[0]?b[S++]=k[E]||0:(b=[k[E]],S=1)}while((E++<w||null!=b[0])&&y--);u=null!=b[0],d[0]||d.splice(0,1)}if(a==BASE){for(h=1,y=d[0];y>=10;y/=10,h++);_(p,o+(p.e=h+c*LOG_BASE-1)+1,s,u)}else p.e=c,p.r=+u;return p}}(),s=/^(-?)0([xbo])(?=\w[\w.]*$)/i,a=/^([^.]+)\.$/,l=/^\.([^.]+)$/,c=/^-?(Infinity|NaN)$/,h=/^\s*\+(?=[\w.])|^\s+|\s+$/g,r=function(e,t,n,r){var i,o=n?t:t.replace(h,"");if(c.test(o))e.s=isNaN(o)?null:o<0?-1:1;else{if(!n&&(o=o.replace(s,(function(e,t,n){return i="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=i?e:t})),r&&(i=r,o=o.replace(a,"$1").replace(l,"0.$1")),t!=o))return new v(o,i);if(v.DEBUG)throw Error(bignumberError+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},u.absoluteValue=u.abs=function(){var e=new v(this);return e.s<0&&(e.s=1),e},u.comparedTo=function(e,t){return compare(this,new v(e,t))},u.decimalPlaces=u.dp=function(e,t){var n,r,i,o=this;if(null!=e)return intCheck(e,0,MAX),null==t?t=m:intCheck(t,0,8),_(new v(o),e+o.e+1,t);if(!(n=o.c))return null;if(r=((i=n.length-1)-bitFloor(this.e/LOG_BASE))*LOG_BASE,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},u.dividedBy=u.div=function(e,n){return t(this,new v(e,n),g,m)},u.dividedToIntegerBy=u.idiv=function(e,n){return t(this,new v(e,n),0,1)},u.exponentiatedBy=u.pow=function(e,t){var n,r,i,o,s,a,l,c,h=this;if((e=new v(e)).c&&!e.isInteger())throw Error(bignumberError+"Exponent not an integer: "+N(e));if(null!=t&&(t=new v(t)),s=e.e>14,!h.c||!h.c[0]||1==h.c[0]&&!h.e&&1==h.c.length||!e.c||!e.c[0])return c=new v(Math.pow(+N(h),s?e.s*(2-isOdd(e)):+N(e))),t?c.mod(t):c;if(a=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new v(NaN);(r=!a&&h.isInteger()&&t.isInteger())&&(h=h.mod(t))}else{if(e.e>9&&(h.e>0||h.e<-1||(0==h.e?h.c[0]>1||s&&h.c[1]>=24e7:h.c[0]<8e13||s&&h.c[0]<=9999975e7)))return o=h.s<0&&isOdd(e)?-0:0,h.e>-1&&(o=1/o),new v(a?1/o:o);w&&(o=mathceil(w/LOG_BASE+2))}for(s?(n=new v(.5),a&&(e.s=1),l=isOdd(e)):l=(i=Math.abs(+N(e)))%2,c=new v(f);;){if(l){if(!(c=c.times(h)).c)break;o?c.c.length>o&&(c.c.length=o):r&&(c=c.mod(t))}if(i){if(0===(i=mathfloor(i/2)))break;l=i%2}else if(_(e=e.times(n),e.e+1,1),e.e>14)l=isOdd(e);else{if(0===(i=+N(e)))break;l=i%2}h=h.times(h),o?h.c&&h.c.length>o&&(h.c.length=o):r&&(h=h.mod(t))}return r?c:(a&&(c=f.div(c)),t?c.mod(t):o?_(c,w,m,undefined):c)},u.integerValue=function(e){var t=new v(this);return null==e?e=m:intCheck(e,0,8),_(t,t.e+1,e)},u.isEqualTo=u.eq=function(e,t){return 0===compare(this,new v(e,t))},u.isFinite=function(){return!!this.c},u.isGreaterThan=u.gt=function(e,t){return compare(this,new v(e,t))>0},u.isGreaterThanOrEqualTo=u.gte=function(e,t){return 1===(t=compare(this,new v(e,t)))||0===t},u.isInteger=function(){return!!this.c&&bitFloor(this.e/LOG_BASE)>this.c.length-2},u.isLessThan=u.lt=function(e,t){return compare(this,new v(e,t))<0},u.isLessThanOrEqualTo=u.lte=function(e,t){return-1===(t=compare(this,new v(e,t)))||0===t},u.isNaN=function(){return!this.s},u.isNegative=function(){return this.s<0},u.isPositive=function(){return this.s>0},u.isZero=function(){return!!this.c&&0==this.c[0]},u.minus=function(e,t){var n,r,i,o,s=this,a=s.s;if(t=(e=new v(e,t)).s,!a||!t)return new v(NaN);if(a!=t)return e.s=-t,s.plus(e);var l=s.e/LOG_BASE,c=e.e/LOG_BASE,h=s.c,u=e.c;if(!l||!c){if(!h||!u)return h?(e.s=-t,e):new v(u?s:NaN);if(!h[0]||!u[0])return u[0]?(e.s=-t,e):new v(h[0]?s:3==m?-0:0)}if(l=bitFloor(l),c=bitFloor(c),h=h.slice(),a=l-c){for((o=a<0)?(a=-a,i=h):(c=l,i=u),i.reverse(),t=a;t--;i.push(0));i.reverse()}else for(r=(o=(a=h.length)<(t=u.length))?a:t,a=t=0;t<r;t++)if(h[t]!=u[t]){o=h[t]<u[t];break}if(o&&(i=h,h=u,u=i,e.s=-e.s),(t=(r=u.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=BASE-1;r>a;){if(h[--r]<u[r]){for(n=r;n&&!h[--n];h[n]=t);--h[n],h[r]+=BASE}h[r]-=u[r]}for(;0==h[0];h.splice(0,1),--c);return h[0]?x(e,h,c):(e.s=3==m?-1:1,e.c=[e.e=0],e)},u.modulo=u.mod=function(e,n){var r,i,o=this;return e=new v(e,n),!o.c||!e.s||e.c&&!e.c[0]?new v(NaN):!e.c||o.c&&!o.c[0]?new v(o):(9==E?(i=e.s,e.s=1,r=t(o,e,0,3),e.s=i,r.s*=i):r=t(o,e,0,E),(e=o.minus(r.times(e))).c[0]||1!=E||(e.s=o.s),e)},u.multipliedBy=u.times=function(e,t){var n,r,i,o,s,a,l,c,h,u,f,g,m,p,d,b=this,S=b.c,A=(e=new v(e,t)).c;if(!(S&&A&&S[0]&&A[0]))return!b.s||!e.s||S&&!S[0]&&!A||A&&!A[0]&&!S?e.c=e.e=e.s=null:(e.s*=b.s,S&&A?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=bitFloor(b.e/LOG_BASE)+bitFloor(e.e/LOG_BASE),e.s*=b.s,(l=S.length)<(u=A.length)&&(m=S,S=A,A=m,i=l,l=u,u=i),i=l+u,m=[];i--;m.push(0));for(p=BASE,d=SQRT_BASE,i=u;--i>=0;){for(n=0,f=A[i]%d,g=A[i]/d|0,o=i+(s=l);o>i;)n=((c=f*(c=S[--s]%d)+(a=g*c+(h=S[s]/d|0)*f)%d*d+m[o]+n)/p|0)+(a/d|0)+g*h,m[o--]=c%p;m[o]=n}return n?++r:m.splice(0,1),x(e,m,r)},u.negated=function(){var e=new v(this);return e.s=-e.s||null,e},u.plus=function(e,t){var n,r=this,i=r.s;if(t=(e=new v(e,t)).s,!i||!t)return new v(NaN);if(i!=t)return e.s=-t,r.minus(e);var o=r.e/LOG_BASE,s=e.e/LOG_BASE,a=r.c,l=e.c;if(!o||!s){if(!a||!l)return new v(i/0);if(!a[0]||!l[0])return l[0]?e:new v(a[0]?r:0*i)}if(o=bitFloor(o),s=bitFloor(s),a=a.slice(),i=o-s){for(i>0?(s=o,n=l):(i=-i,n=a),n.reverse();i--;n.push(0));n.reverse()}for((i=a.length)-(t=l.length)<0&&(n=l,l=a,a=n,t=i),i=0;t;)i=(a[--t]=a[t]+l[t]+i)/BASE|0,a[t]=BASE===a[t]?0:a[t]%BASE;return i&&(a=[i].concat(a),++s),x(e,a,s)},u.precision=u.sd=function(e,t){var n,r,i,o=this;if(null!=e&&e!==!!e)return intCheck(e,1,MAX),null==t?t=m:intCheck(t,0,8),_(new v(o),e,t);if(!(n=o.c))return null;if(r=(i=n.length-1)*LOG_BASE+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&o.e+1>r&&(r=o.e+1),r},u.shiftedBy=function(e){return intCheck(e,-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER),this.times("1e"+e)},u.squareRoot=u.sqrt=function(){var e,n,r,i,o,s=this,a=s.c,l=s.s,c=s.e,h=g+4,u=new v("0.5");if(1!==l||!a||!a[0])return new v(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);if(0==(l=Math.sqrt(+N(s)))||l==1/0?(((n=coeffToString(a)).length+c)%2==0&&(n+="0"),l=Math.sqrt(+n),c=bitFloor((c+1)/2)-(c<0||c%2),r=new v(n=l==1/0?"5e"+c:(n=l.toExponential()).slice(0,n.indexOf("e")+1)+c)):r=new v(l+""),r.c[0])for((l=(c=r.e)+h)<3&&(l=0);;)if(o=r,r=u.times(o.plus(t(s,o,h,1))),coeffToString(o.c).slice(0,l)===(n=coeffToString(r.c)).slice(0,l)){if(r.e<c&&--l,"9999"!=(n=n.slice(l-3,l+1))&&(i||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(_(r,r.e+g+2,1),e=!r.times(r).eq(s));break}if(!i&&(_(o,o.e+g+2,0),o.times(o).eq(s))){r=o;break}h+=4,l+=4,i=1}return _(r,r.e+g+1,m,e)},u.toExponential=function(e,t){return null!=e&&(intCheck(e,0,MAX),e++),y(this,e,t,1)},u.toFixed=function(e,t){return null!=e&&(intCheck(e,0,MAX),e=e+this.e+1),y(this,e,t)},u.toFormat=function(e,t,n){var r,i=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=O;else if("object"!=typeof n)throw Error(bignumberError+"Argument not an object: "+n);if(r=i.toFixed(e,t),i.c){var o,s=r.split("."),a=+n.groupSize,l=+n.secondaryGroupSize,c=n.groupSeparator||"",h=s[0],u=s[1],f=i.s<0,g=f?h.slice(1):h,m=g.length;if(l&&(o=a,a=l,l=o,m-=o),a>0&&m>0){for(o=m%a||a,h=g.substr(0,o);o<m;o+=a)h+=c+g.substr(o,a);l>0&&(h+=c+g.slice(o)),f&&(h="-"+h)}r=u?h+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?u.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):u):h}return(n.prefix||"")+r+(n.suffix||"")},u.toFraction=function(e){var n,r,i,o,s,a,l,c,h,u,g,p,d=this,b=d.c;if(null!=e&&(!(l=new v(e)).isInteger()&&(l.c||1!==l.s)||l.lt(f)))throw Error(bignumberError+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+N(l));if(!b)return new v(d);for(n=new v(f),h=r=new v(f),i=c=new v(f),p=coeffToString(b),s=n.e=p.length-d.e-1,n.c[0]=POWS_TEN[(a=s%LOG_BASE)<0?LOG_BASE+a:a],e=!e||l.comparedTo(n)>0?s>0?n:h:l,a=S,S=1/0,l=new v(p),c.c[0]=0;u=t(l,n,0,1),1!=(o=r.plus(u.times(i))).comparedTo(e);)r=i,i=o,h=c.plus(u.times(o=h)),c=o,n=l.minus(u.times(o=n)),l=o;return o=t(e.minus(r),i,0,1),c=c.plus(o.times(h)),r=r.plus(o.times(i)),c.s=h.s=d.s,g=t(h,i,s*=2,m).minus(d).abs().comparedTo(t(c,r,s,m).minus(d).abs())<1?[h,i]:[c,r],S=a,g},u.toNumber=function(){return+N(this)},u.toPrecision=function(e,t){return null!=e&&intCheck(e,1,MAX),y(this,e,t,2)},u.toString=function(e){var t,r=this,i=r.s,o=r.e;return null===o?i?(t="Infinity",i<0&&(t="-"+t)):t="NaN":(null==e?t=o<=p||o>=d?toExponential(coeffToString(r.c),o):toFixedPoint(coeffToString(r.c),o,"0"):10===e&&C?t=toFixedPoint(coeffToString((r=_(new v(r),g+o+1,m)).c),r.e,"0"):(intCheck(e,2,B.length,"Base"),t=n(toFixedPoint(coeffToString(r.c),o,"0"),10,e,i,!0)),i<0&&r.c[0]&&(t="-"+t)),t},u.valueOf=u.toJSON=function(){return N(this)},u._isBigNumber=!0,u[Symbol.toStringTag]="BigNumber",u[Symbol.for("nodejs.util.inspect.custom")]=u.valueOf,null!=e&&v.set(e),v}function bitFloor(e){var t=0|e;return e>0||e===t?t:t-1}function coeffToString(e){for(var t,n,r=1,i=e.length,o=e[0]+"";r<i;){for(t=e[r++]+"",n=LOG_BASE-t.length;n--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function compare(e,t){var n,r,i=e.c,o=t.c,s=e.s,a=t.s,l=e.e,c=t.e;if(!s||!a)return null;if(n=i&&!i[0],r=o&&!o[0],n||r)return n?r?0:-a:s;if(s!=a)return s;if(n=s<0,r=l==c,!i||!o)return r?0:!i^n?1:-1;if(!r)return l>c^n?1:-1;for(a=(l=i.length)<(c=o.length)?l:c,s=0;s<a;s++)if(i[s]!=o[s])return i[s]>o[s]^n?1:-1;return l==c?0:l>c^n?1:-1}function intCheck(e,t,n,r){if(e<t||e>n||e!==mathfloor(e))throw Error(bignumberError+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function isOdd(e){var t=e.c.length-1;return bitFloor(e.e/LOG_BASE)==t&&e.c[t]%2!=0}function toExponential(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function toFixedPoint(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(++t>(r=e.length)){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var BigNumber=clone();class Float{constructor(e,t,n,r){Object.assign(this,{is_negative:e,exponent:n,is_normalized:r,mantissa:t}),this.ROUNDING=6}asNumber(){return this.exponent===this.RESERVED?new BigNumber(this.reservedNumber()):new BigNumber(this.is_normalized?1:0).plus(this.mantissa).times(this.is_negative?-1:1).times(new BigNumber(2).pow(this.exponent-this.BIAS))}toString(){return this.asNumber().round(this.ROUNDING).toString()}}class Float80 extends Float{get BIAS(){return 16383}get RESERVED(){return 32767}static fromBytes(e,t=!1){t||(e=Array.from(e).reverse());const n=Boolean(128&e[9]),r=(e[9]<<1&255)<<7|e[8],i=Boolean(128&e[7]);e[7]=127&e[7];const o=e.slice(0,8).reverse().map((e=>e.toString(2).padStart(8,"0"))).join("").substr(1),s=new BigNumber("0."+o,2);return new Float80(n,s,r,i)}reservedNumber(){return(this.is_negative?"-":"")+(this.mantissa.isZero()?"Infinity":"NaN")}}function decodeSample(e){let t=0;128&(e^=85)&&(e&=-129,t=-1);let n=4+((240&e)>>4),r=0;return r=4!=n?1<<n|(15&e)<<n-4|1<<n-5:e<<1|1,r=0===t?r:-r,8*r*-1}function decode(e){let t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=decodeSample(e[n]);return t}const decodeTable=[0,132,396,924,1980,4092,8316,16764];function decodeSample$1(e){let t,n,r,i;return t=128&(e=~e),n=e>>4&7,r=15&e,i=decodeTable[n]+(r<<n+3),0!=t&&(i=-i),i}function decode$1(e){let t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=decodeSample$1(e[n]);return t}async function parse$2(e){for(;e.idx<e.dv.byteLength-8;){const t=readChunk(e);switch(t.name){case"FVER":e.versionTimestamp=getUint32(e),log("Apple Version Timestamp: "+new Date(1e3*e.versionTimestamp-20828484e5).toLocaleString("de-DE",{dateStyle:"medium",timeStyle:"medium"}));break;case"COMM":log("COMM chunk size: "+t.size);const n=e.idx+t.size;e.comm={numChannels:getInt16(e),numSampleFrames:getUint32(e),sampleSize:getInt16(e),sampleRate:getIEEE754(e)},e.idx<n&&(e.comm.compressionType=getString(e,4)),e.idx<n&&(e.comm.compressionName=getString(e,4)),log("numChannels: "+e.comm.numChannels),log("numSampleFrames: "+e.comm.numSampleFrames),log("sampleSize = Bits: "+e.comm.sampleSize),log("sampleRate: "+e.comm.sampleRate),e.comm.compressionType&&log("compressionType: "+e.comm.compressionType),e.channels=e.comm.numChannels,e.sampleRate=e.comm.sampleRate,e.bits=e.comm.sampleSize;break;case"SSND":if(log("SSND chunk size: "+t.size),e.ssnd={offset:getUint32(e),blockSize:getUint32(e)},e.comm.compressionType&&"NONE"!=e.comm.compressionType){const n=new Uint8Array(t.size);n.set(new Uint8Array(e.dv.buffer).slice(e.idx,e.idx+t.size)),"alaw"==e.comm.compressionType&&(e.data=decode(n)),"ulaw"==e.comm.compressionType&&(e.data=decode$1(n)),e.idx+=t.size}else if(8===e.bits)e.data=new Int8Array(t.size),e.data.set(new Int8Array(e.dv.buffer).slice(e.idx,e.idx+t.size)),e.idx+=t.size;else if(16===e.bits){e.data=[];for(let n=0;n<t.size/2;n++)e.data.push(getInt16(e));e.data=new Int16Array(e.data)}else if(24===e.bits){e.data=[];for(let n=0;n<t.size/3;n++)e.data.push(getInt24(e));e.data=new Int32Array(e.data)}else if(32===e.bits){e.data=[];for(let n=0;n<t.size/4;n++)e.data.push(getInt32(e));e.data=new Int32Array(e.data)}break;default:processCommonChunks(e,t)}}e.comm?(prepareChannels$1(e),await initContext(e),e.play=()=>{play(e)},e.stop=()=>{stop(e)}):log("Missing COMM chunk. This is not a valid AIFF file")}function prepareChannels$1(e){e.ch=[];for(let t=0;t<e.channels;t++)e.ch.push([]);for(let t=0;t<e.data.length;t++){let n=e.data[t];8==e.bits&&(n/=128),16==e.bits&&(n/=32768),24==e.bits&&(n/=2147483648),32==e.bits&&(n/=2147483648),e.ch[t%e.channels].push(n)}}function getIEEE754(e){let t=[];for(let n=0;n<10;n++)t.push(getUint8(e));return Float80.fromBytes(t).asNumber().toNumber()}class IFF{constructor(e,t){this.idx=0,this.cb=t,"string"==typeof e&&this.load(e),"object"==typeof e&&this.parse(e)}load(e){fetch(e).then((e=>e.arrayBuffer())).then((e=>{log("File loaded"),this.parse(e)})).catch((e=>console.error(e)))}async parse(e){this.dv=new DataView(e);const t=getString(this,4);if(-1!==["FORM","LIST","CAT "].indexOf(t))if("FORM"===t){switch(this.group=t,this.formSize=getUint32(this),log(this.group+" chunk size = "+this.formSize),this.formSize+8!==this.dv.byteLength&&log("FORM size does not match file size: "+this.formSize+"8 !== "+this.dv.byteLength),this.subType=getString(this,4),this.subType){case"ILBM":await parse(this);break;case"SMUS":break;case"8SVX":case"16SV":this.bits="8SVX"==this.subType?8:16,await parse$1(this);break;case"AIFF":case"AIFC":await parse$2(this)}this.cb()}else log("Only FORM group is supported");else log("This is not an IFF-85 file")}}window.IFF=IFF;export{IFF};